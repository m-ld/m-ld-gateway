<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg"
     contentStyleType="text/css" height="595px" preserveAspectRatio="none"
     style="width:616px;height:595px;background:#FFFFFF;" version="1.1" viewBox="0 0 616 595"
     width="616px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.4883" id="_title" style="stroke:none;stroke-width:1.0;" width="197" x="210.5" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="187" x="215.5" y="28.5352">Multi-Write "Transaction"</text><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="103" x2="103" y1="73.9766" y2="588.9453"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="98" y="103.2871"/><rect fill="#FFFFFF" height="150.5527" style="stroke:#181818;stroke-width:1.0;" width="10" x="98" y="261.8398"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="98" y="499.3242"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="480" x2="480" y1="73.9766" y2="588.9453"/><rect fill="#FFFFFF" height="501.9688" style="stroke:#181818;stroke-width:1.0;" width="10" x="475" y="81.9766"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="71" x="67.5" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="74.5" y="63.0234">Gateway</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42" x="459" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="466" y="63.0234">App</text><polygon fill="#181818" points="119,99.2871,109,103.2871,119,107.2871,115,103.2871" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="113" x2="474" y1="103.2871" y2="103.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="125" y="98.5449">POST ~/state?lock { ... }</text><line style="stroke:#181818;stroke-width:1.0;" x1="108" x2="150" y1="132.5977" y2="132.5977"/><line style="stroke:#181818;stroke-width:1.0;" x1="150" x2="150" y1="132.5977" y2="145.5977"/><line style="stroke:#181818;stroke-width:1.0;" x1="109" x2="150" y1="145.5977" y2="145.5977"/><polygon fill="#181818" points="119,141.5977,109,145.5977,119,149.5977,115,145.5977" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="115" y="127.8555">enqueue Update 1</text><polygon fill="#181818" points="463,170.9082,473,174.9082,463,178.9082,467,174.9082" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="108" x2="469" y1="174.9082" y2="174.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="348" x="115" y="170.166">201 Created ETag: "1" Location: ~/state?lock {Update 1}</text><polygon fill="#181818" points="16,170.9082,6,174.9082,16,178.9082,12,174.9082" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="10" x2="102" y1="174.9082" y2="174.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="22" y="170.166">Operation 1</text><line style="stroke:#181818;stroke-width:1.0;" x1="485" x2="527" y1="219.5293" y2="219.5293"/><line style="stroke:#181818;stroke-width:1.0;" x1="527" x2="527" y1="219.5293" y2="232.5293"/><line style="stroke:#181818;stroke-width:1.0;" x1="486" x2="527" y1="232.5293" y2="232.5293"/><polygon fill="#181818" points="496,228.5293,486,232.5293,496,236.5293,492,232.5293" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="492" y="199.4766">process</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="492" y="214.7871">Update 1</text><polygon fill="#181818" points="119,257.8398,109,261.8398,119,265.8398,115,261.8398" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="113" x2="474" y1="261.8398" y2="261.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="125" y="257.0977">POST ~/state { ... }</text><path d="M490,245.5293 L490,300.5293 L609,300.5293 L609,255.5293 L599,245.5293 L490,245.5293 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M599,245.5293 L599,255.5293 L609,255.5293 L599,245.5293 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="496" y="263.0977">implicit DELETE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="496" y="278.4082">~/state?lock</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="496" y="293.7188">If-Match: "1"</text><line style="stroke:#181818;stroke-width:1.0;" x1="108" x2="150" y1="327.7715" y2="327.7715"/><line style="stroke:#181818;stroke-width:1.0;" x1="150" x2="150" y1="327.7715" y2="340.7715"/><line style="stroke:#181818;stroke-width:1.0;" x1="109" x2="150" y1="340.7715" y2="340.7715"/><polygon fill="#181818" points="119,336.7715,109,340.7715,119,344.7715,115,340.7715" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="115" y="323.0293">dequeue Update 1</text><line style="stroke:#181818;stroke-width:1.0;" x1="108" x2="150" y1="370.082" y2="370.082"/><line style="stroke:#181818;stroke-width:1.0;" x1="150" x2="150" y1="370.082" y2="383.082"/><line style="stroke:#181818;stroke-width:1.0;" x1="109" x2="150" y1="383.082" y2="383.082"/><polygon fill="#181818" points="119,379.082,109,383.082,119,387.082,115,383.082" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="115" y="365.3398">enqueue Update 2</text><polygon fill="#181818" points="463,408.3926,473,412.3926,463,416.3926,467,412.3926" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="108" x2="469" y1="412.3926" y2="412.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="115" y="407.6504">200 OK ETag: "2" {Update 2}</text><polygon fill="#181818" points="16,408.3926,6,412.3926,16,416.3926,12,412.3926" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="10" x2="102" y1="412.3926" y2="412.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="22" y="407.6504">Operation 2</text><line style="stroke:#181818;stroke-width:1.0;" x1="485" x2="527" y1="457.0137" y2="457.0137"/><line style="stroke:#181818;stroke-width:1.0;" x1="527" x2="527" y1="457.0137" y2="470.0137"/><line style="stroke:#181818;stroke-width:1.0;" x1="486" x2="527" y1="470.0137" y2="470.0137"/><polygon fill="#181818" points="496,466.0137,486,470.0137,496,474.0137,492,470.0137" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="492" y="436.9609">process</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="492" y="452.2715">Update 2</text><polygon fill="#181818" points="119,495.3242,109,499.3242,119,503.3242,115,499.3242" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="113" x2="474" y1="499.3242" y2="499.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="125" y="494.582">DELETE ~/state?lock If-Match: "2"</text><line style="stroke:#181818;stroke-width:1.0;" x1="108" x2="150" y1="528.6348" y2="528.6348"/><line style="stroke:#181818;stroke-width:1.0;" x1="150" x2="150" y1="528.6348" y2="541.6348"/><line style="stroke:#181818;stroke-width:1.0;" x1="109" x2="150" y1="541.6348" y2="541.6348"/><polygon fill="#181818" points="119,537.6348,109,541.6348,119,545.6348,115,541.6348" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="115" y="523.8926">dequeue Update 2</text><polygon fill="#181818" points="463,566.9453,473,570.9453,463,574.9453,467,570.9453" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="108" x2="469" y1="570.9453" y2="570.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="115" y="566.2031">200 OK</text><!--MD5=[d57f1507410105d6781751dcb138a623]
@startuml
'https://plantuml.com/sequence-diagram
!pragma teoz true
hide footbox

title: Multi-Write "Transaction"

participant Gateway as gw
participant "App" as app

activate app
app -> gw ++: POST \~/state?lock { ... }
gw -> gw: enqueue Update 1
return 201 Created ETag: "1" Location: \~/state?lock {Update 1}
& <- gw: Operation 1
app -> app: process\nUpdate 1
app -> gw ++: POST \~/state { ... }
note right
implicit DELETE
\~/state?lock
If-Match: "1"
end note
gw -> gw: dequeue Update 1
gw -> gw: enqueue Update 2
return 200 OK ETag: "2" {Update 2}
& <- gw: Operation 2
app -> app: process\nUpdate 2
app -> gw ++: DELETE \~/state?lock If-Match: "2"
gw -> gw: dequeue Update 2
return 200 OK
deactivate app

@enduml

@startuml
!pragma teoz true
hide footbox

title: Multi-Write "Transaction"

participant Gateway as gw
participant "App" as app

activate app
app -> gw ++: POST \~/state?lock { ... }
gw -> gw: enqueue Update 1
return 201 Created ETag: "1" Location: \~/state?lock {Update 1}
& <- gw: Operation 1
app -> app: process\nUpdate 1
app -> gw ++: POST \~/state { ... }
note right
implicit DELETE
\~/state?lock
If-Match: "1"
end note
gw -> gw: dequeue Update 1
gw -> gw: enqueue Update 2
return 200 OK ETag: "2" {Update 2}
& <- gw: Operation 2
app -> app: process\nUpdate 2
app -> gw ++: DELETE \~/state?lock If-Match: "2"
gw -> gw: dequeue Update 2
return 200 OK
deactivate app

@enduml

PlantUML version 1.2022.8(Sun Sep 25 10:00:33 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>