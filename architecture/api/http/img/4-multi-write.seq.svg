<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg"
     contentStyleType="text/css" height="557px" preserveAspectRatio="none"
     style="width:482px;height:557px;background:#FFFFFF;" version="1.1" viewBox="0 0 482 557"
     width="482px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="478.3477" style="stroke:#000000;stroke-width:1.5;" width="468" x="8" y="48.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="122" x2="122" y1="36.4883" y2="550.8359"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="117" y="97.1094"/><rect fill="#FFFFFF" height="135.2422" style="stroke:#181818;stroke-width:1.0;" width="10" x="117" y="240.3516"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="117" y="447.2148"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="326" x2="326" y1="36.4883" y2="550.8359"/><rect fill="#FFFFFF" height="456.0371" style="stroke:#181818;stroke-width:1.0;" width="10" x="321" y="75.7988"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="71" x="86.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="93.5" y="25.5352">Gateway</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42" x="305" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="312" y="25.5352">App</text><path d="M8,48.4883 L226,48.4883 L226,55.7988 L216,65.7988 L8,65.7988 L8,48.4883 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="478.3477" style="stroke:#000000;stroke-width:1.5;" width="468" x="8" y="48.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="169" x="23" y="62.0566">multi-write "transaction"</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="41" x="241" y="61.123">[happy]</text><polygon fill="#181818" points="138,93.1094,128,97.1094,138,101.1094,134,97.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="132" x2="320" y1="97.1094" y2="97.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="144" y="92.3672">POST /state { ... }</text><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="169" y1="126.4199" y2="126.4199"/><line style="stroke:#181818;stroke-width:1.0;" x1="169" x2="169" y1="126.4199" y2="139.4199"/><line style="stroke:#181818;stroke-width:1.0;" x1="128" x2="169" y1="139.4199" y2="139.4199"/><polygon fill="#181818" points="138,135.4199,128,139.4199,138,143.4199,134,139.4199" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="134" y="121.6777">enqueue Update 1</text><polygon fill="#181818" points="309,164.7305,319,168.7305,309,172.7305,313,168.7305" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="127" x2="315" y1="168.7305" y2="168.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="134" y="163.9883">200 OK: {Update 1, state=1}</text><polygon fill="#181818" points="16,164.7305,6,168.7305,16,172.7305,12,168.7305" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="10" x2="121" y1="168.7305" y2="168.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="22" y="163.9883">Operation 1</text><line style="stroke:#181818;stroke-width:1.0;" x1="331" x2="373" y1="198.041" y2="198.041"/><line style="stroke:#181818;stroke-width:1.0;" x1="373" x2="373" y1="198.041" y2="211.041"/><line style="stroke:#181818;stroke-width:1.0;" x1="332" x2="373" y1="211.041" y2="211.041"/><polygon fill="#181818" points="342,207.041,332,211.041,342,215.041,338,211.041" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="338" y="193.2988">process Update 1</text><polygon fill="#181818" points="138,236.3516,128,240.3516,138,244.3516,134,240.3516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="132" x2="320" y1="240.3516" y2="240.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="144" y="235.6094">POST /state/1 { ... }</text><path d="M336,224.041 L336,264.041 L455,264.041 L455,234.041 L445,224.041 L336,224.041 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M445,224.041 L445,234.041 L455,234.041 L445,224.041 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="342" y="241.6094">implicit DELETE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="342" y="256.9199">state/1/lock</text><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="169" y1="290.9727" y2="290.9727"/><line style="stroke:#181818;stroke-width:1.0;" x1="169" x2="169" y1="290.9727" y2="303.9727"/><line style="stroke:#181818;stroke-width:1.0;" x1="128" x2="169" y1="303.9727" y2="303.9727"/><polygon fill="#181818" points="138,299.9727,128,303.9727,138,307.9727,134,303.9727" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="134" y="286.2305">dequeue Update 1</text><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="169" y1="333.2832" y2="333.2832"/><line style="stroke:#181818;stroke-width:1.0;" x1="169" x2="169" y1="333.2832" y2="346.2832"/><line style="stroke:#181818;stroke-width:1.0;" x1="128" x2="169" y1="346.2832" y2="346.2832"/><polygon fill="#181818" points="138,342.2832,128,346.2832,138,350.2832,134,346.2832" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="134" y="328.541">enqueue Update 2</text><polygon fill="#181818" points="309,371.5938,319,375.5938,309,379.5938,313,375.5938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="127" x2="315" y1="375.5938" y2="375.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="134" y="370.8516">200 OK: {Update 2, state=2}</text><polygon fill="#181818" points="16,371.5938,6,375.5938,16,379.5938,12,375.5938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="10" x2="121" y1="375.5938" y2="375.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="22" y="370.8516">Operation 2</text><line style="stroke:#181818;stroke-width:1.0;" x1="331" x2="373" y1="404.9043" y2="404.9043"/><line style="stroke:#181818;stroke-width:1.0;" x1="373" x2="373" y1="404.9043" y2="417.9043"/><line style="stroke:#181818;stroke-width:1.0;" x1="332" x2="373" y1="417.9043" y2="417.9043"/><polygon fill="#181818" points="342,413.9043,332,417.9043,342,421.9043,338,417.9043" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="338" y="400.1621">process Update 2</text><polygon fill="#181818" points="138,443.2148,128,447.2148,138,451.2148,134,447.2148" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="132" x2="320" y1="447.2148" y2="447.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="144" y="442.4727">DELETE /state/2/lock</text><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="169" y1="476.5254" y2="476.5254"/><line style="stroke:#181818;stroke-width:1.0;" x1="169" x2="169" y1="476.5254" y2="489.5254"/><line style="stroke:#181818;stroke-width:1.0;" x1="128" x2="169" y1="489.5254" y2="489.5254"/><polygon fill="#181818" points="138,485.5254,128,489.5254,138,493.5254,134,489.5254" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="134" y="471.7832">dequeue Update 2</text><polygon fill="#181818" points="309,514.8359,319,518.8359,309,522.8359,313,518.8359" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="127" x2="315" y1="518.8359" y2="518.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="134" y="514.0938">200 OK</text><!--MD5=[dac05fe1c5704d4edc6802e347679c31]
@startuml
'https://plantuml.com/sequence-diagram
!pragma teoz true
hide footbox

participant Gateway as gw
participant "App" as app

group multi-write "transaction" [happy]
activate app
app -> gw ++: POST /state { ... }
gw -> gw: enqueue Update 1
return 200 OK: {Update 1, state=1}
& <- gw: Operation 1
app -> app: process Update 1
app -> gw ++: POST /state/1 { ... }
note right
implicit DELETE
state/1/lock
end note
gw -> gw: dequeue Update 1
gw -> gw: enqueue Update 2
return 200 OK: {Update 2, state=2}
& <- gw: Operation 2
app -> app: process Update 2
app -> gw ++: DELETE /state/2/lock
gw -> gw: dequeue Update 2
return 200 OK
deactivate app
end group

@enduml

@startuml
!pragma teoz true
hide footbox

participant Gateway as gw
participant "App" as app

group multi-write "transaction" [happy]
activate app
app -> gw ++: POST /state { ... }
gw -> gw: enqueue Update 1
return 200 OK: {Update 1, state=1}
& <- gw: Operation 1
app -> app: process Update 1
app -> gw ++: POST /state/1 { ... }
note right
implicit DELETE
state/1/lock
end note
gw -> gw: dequeue Update 1
gw -> gw: enqueue Update 2
return 200 OK: {Update 2, state=2}
& <- gw: Operation 2
app -> app: process Update 2
app -> gw ++: DELETE /state/2/lock
gw -> gw: dequeue Update 2
return 200 OK
deactivate app
end group

@enduml

PlantUML version 1.2022.8(Sun Sep 25 10:00:33 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>