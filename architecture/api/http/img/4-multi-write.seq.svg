<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg"
     contentStyleType="text/css" height="565px" preserveAspectRatio="none"
     style="width:488px;height:565px;background:#FFFFFF;" version="1.1" viewBox="0 0 488 565"
     width="488px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.4883" id="_title" style="stroke:none;stroke-width:1.0;" width="197" x="146.5" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="187" x="151.5" y="28.5352">Multi-Write "Transaction"</text><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="103" x2="103" y1="73.9766" y2="558.3242"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="98" y="103.2871"/><rect fill="#FFFFFF" height="150.5527" style="stroke:#181818;stroke-width:1.0;" width="10" x="98" y="246.5293"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="98" y="468.7031"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="352" x2="352" y1="73.9766" y2="558.3242"/><rect fill="#FFFFFF" height="471.3477" style="stroke:#181818;stroke-width:1.0;" width="10" x="347" y="81.9766"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="71" x="67.5" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="74.5" y="63.0234">Gateway</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42" x="331" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="338" y="63.0234">App</text><polygon fill="#181818" points="119,99.2871,109,103.2871,119,107.2871,115,103.2871" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="113" x2="346" y1="103.2871" y2="103.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="125" y="98.5449">POST ~/state { ... }</text><line style="stroke:#181818;stroke-width:1.0;" x1="108" x2="150" y1="132.5977" y2="132.5977"/><line style="stroke:#181818;stroke-width:1.0;" x1="150" x2="150" y1="132.5977" y2="145.5977"/><line style="stroke:#181818;stroke-width:1.0;" x1="109" x2="150" y1="145.5977" y2="145.5977"/><polygon fill="#181818" points="119,141.5977,109,145.5977,119,149.5977,115,145.5977" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="115" y="127.8555">enqueue Update 1</text><polygon fill="#181818" points="335,170.9082,345,174.9082,335,178.9082,339,174.9082" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="108" x2="341" y1="174.9082" y2="174.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="115" y="170.166">200 OK ETag: "1" {Update 1}</text><polygon fill="#181818" points="16,170.9082,6,174.9082,16,178.9082,12,174.9082" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="10" x2="102" y1="174.9082" y2="174.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="22" y="170.166">Operation 1</text><line style="stroke:#181818;stroke-width:1.0;" x1="357" x2="399" y1="204.2188" y2="204.2188"/><line style="stroke:#181818;stroke-width:1.0;" x1="399" x2="399" y1="204.2188" y2="217.2188"/><line style="stroke:#181818;stroke-width:1.0;" x1="358" x2="399" y1="217.2188" y2="217.2188"/><polygon fill="#181818" points="368,213.2188,358,217.2188,368,221.2188,364,217.2188" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="364" y="199.4766">process Update 1</text><polygon fill="#181818" points="119,242.5293,109,246.5293,119,250.5293,115,246.5293" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="113" x2="346" y1="246.5293" y2="246.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="125" y="241.7871">POST ~/state { ... }</text><path d="M362,230.2188 L362,285.2188 L481,285.2188 L481,240.2188 L471,230.2188 L362,230.2188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M471,230.2188 L471,240.2188 L481,240.2188 L471,230.2188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="368" y="247.7871">implicit DELETE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="368" y="263.0977">~/state/lock</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="368" y="278.4082">If-Match: "1"</text><line style="stroke:#181818;stroke-width:1.0;" x1="108" x2="150" y1="312.4609" y2="312.4609"/><line style="stroke:#181818;stroke-width:1.0;" x1="150" x2="150" y1="312.4609" y2="325.4609"/><line style="stroke:#181818;stroke-width:1.0;" x1="109" x2="150" y1="325.4609" y2="325.4609"/><polygon fill="#181818" points="119,321.4609,109,325.4609,119,329.4609,115,325.4609" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="115" y="307.7188">dequeue Update 1</text><line style="stroke:#181818;stroke-width:1.0;" x1="108" x2="150" y1="354.7715" y2="354.7715"/><line style="stroke:#181818;stroke-width:1.0;" x1="150" x2="150" y1="354.7715" y2="367.7715"/><line style="stroke:#181818;stroke-width:1.0;" x1="109" x2="150" y1="367.7715" y2="367.7715"/><polygon fill="#181818" points="119,363.7715,109,367.7715,119,371.7715,115,367.7715" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="115" y="350.0293">enqueue Update 2</text><polygon fill="#181818" points="335,393.082,345,397.082,335,401.082,339,397.082" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="108" x2="341" y1="397.082" y2="397.082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="115" y="392.3398">200 OK ETag: "2" {Update 2}</text><polygon fill="#181818" points="16,393.082,6,397.082,16,401.082,12,397.082" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="10" x2="102" y1="397.082" y2="397.082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="22" y="392.3398">Operation 2</text><line style="stroke:#181818;stroke-width:1.0;" x1="357" x2="399" y1="426.3926" y2="426.3926"/><line style="stroke:#181818;stroke-width:1.0;" x1="399" x2="399" y1="426.3926" y2="439.3926"/><line style="stroke:#181818;stroke-width:1.0;" x1="358" x2="399" y1="439.3926" y2="439.3926"/><polygon fill="#181818" points="368,435.3926,358,439.3926,368,443.3926,364,439.3926" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="364" y="421.6504">process Update 2</text><polygon fill="#181818" points="119,464.7031,109,468.7031,119,472.7031,115,468.7031" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="113" x2="346" y1="468.7031" y2="468.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="125" y="463.9609">DELETE ~/state/lock If-Match: "2"</text><line style="stroke:#181818;stroke-width:1.0;" x1="108" x2="150" y1="498.0137" y2="498.0137"/><line style="stroke:#181818;stroke-width:1.0;" x1="150" x2="150" y1="498.0137" y2="511.0137"/><line style="stroke:#181818;stroke-width:1.0;" x1="109" x2="150" y1="511.0137" y2="511.0137"/><polygon fill="#181818" points="119,507.0137,109,511.0137,119,515.0137,115,511.0137" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="115" y="493.2715">dequeue Update 2</text><polygon fill="#181818" points="335,536.3242,345,540.3242,335,544.3242,339,540.3242" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="108" x2="341" y1="540.3242" y2="540.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="115" y="535.582">200 OK</text><!--MD5=[ce268acbadcfa1b5c0d2a7bc8e48a82a]
@startuml
'https://plantuml.com/sequence-diagram
!pragma teoz true
hide footbox

title: Multi-Write "Transaction"

participant Gateway as gw
participant "App" as app

activate app
app -> gw ++: POST \~/state { ... }
gw -> gw: enqueue Update 1
return 200 OK ETag: "1" {Update 1}
& <- gw: Operation 1
app -> app: process Update 1
app -> gw ++: POST \~/state { ... }
note right
implicit DELETE
\~/state/lock
If-Match: "1"
end note
gw -> gw: dequeue Update 1
gw -> gw: enqueue Update 2
return 200 OK ETag: "2" {Update 2}
& <- gw: Operation 2
app -> app: process Update 2
app -> gw ++: DELETE \~/state/lock If-Match: "2"
gw -> gw: dequeue Update 2
return 200 OK
deactivate app

@enduml

@startuml
!pragma teoz true
hide footbox

title: Multi-Write "Transaction"

participant Gateway as gw
participant "App" as app

activate app
app -> gw ++: POST \~/state { ... }
gw -> gw: enqueue Update 1
return 200 OK ETag: "1" {Update 1}
& <- gw: Operation 1
app -> app: process Update 1
app -> gw ++: POST \~/state { ... }
note right
implicit DELETE
\~/state/lock
If-Match: "1"
end note
gw -> gw: dequeue Update 1
gw -> gw: enqueue Update 2
return 200 OK ETag: "2" {Update 2}
& <- gw: Operation 2
app -> app: process Update 2
app -> gw ++: DELETE \~/state/lock If-Match: "2"
gw -> gw: dequeue Update 2
return 200 OK
deactivate app

@enduml

PlantUML version 1.2022.8(Sun Sep 25 10:00:33 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>