<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg"
     contentStyleType="text/css" height="513px" preserveAspectRatio="none"
     style="width:515px;height:513px;background:#FFFFFF;" version="1.1" viewBox="0 0 515 513"
     width="515px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="433.7266" style="stroke:#000000;stroke-width:1.5;" width="501" x="8" y="48.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="161" x2="161" y1="36.4883" y2="189.7305"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="161" x2="161" y1="189.7305" y2="217.7305"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="161" x2="161" y1="217.7305" y2="506.2148"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="156" y="97.1094"/><rect fill="#FFFFFF" height="35.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="156" y="239.041"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="156" y="367.2832"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="365" x2="365" y1="36.4883" y2="189.7305"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="365" x2="365" y1="189.7305" y2="217.7305"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="365" x2="365" y1="217.7305" y2="506.2148"/><rect fill="#FFFFFF" height="198.8633" style="stroke:#181818;stroke-width:1.0;" width="10" x="360" y="253.041"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="71" x="125.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="132.5" y="25.5352">Gateway</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42" x="344" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="351" y="25.5352">App</text><path d="M8,48.4883 L206,48.4883 L206,55.7988 L196,65.7988 L8,65.7988 L8,48.4883 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="433.7266" style="stroke:#000000;stroke-width:1.5;" width="501" x="8" y="48.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="149" x="23" y="62.0566">operation with polling</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="41" x="221" y="61.123">[happy]</text><polygon fill="#181818" points="144,93.1094,154,97.1094,144,101.1094,148,97.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="5" x2="150" y1="97.1094" y2="97.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="12" y="92.3672">Operation 1</text><line style="stroke:#181818;stroke-width:1.0;" x1="166" x2="208" y1="126.4199" y2="126.4199"/><line style="stroke:#181818;stroke-width:1.0;" x1="208" x2="208" y1="126.4199" y2="139.4199"/><line style="stroke:#181818;stroke-width:1.0;" x1="167" x2="208" y1="139.4199" y2="139.4199"/><polygon fill="#181818" points="177,135.4199,167,139.4199,177,143.4199,173,139.4199" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="173" y="121.6777">apply Operation 1</text><line style="stroke:#181818;stroke-width:1.0;" x1="166" x2="208" y1="168.7305" y2="168.7305"/><line style="stroke:#181818;stroke-width:1.0;" x1="208" x2="208" y1="168.7305" y2="181.7305"/><line style="stroke:#181818;stroke-width:1.0;" x1="161" x2="208" y1="181.7305" y2="181.7305"/><polygon fill="#181818" points="171,177.7305,161,181.7305,171,185.7305,167,181.7305" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="173" y="163.9883">enqueue Update 1</text><polygon fill="#181818" points="177,235.041,167,239.041,177,243.041,173,239.041" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="171" x2="364" y1="239.041" y2="239.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="183" y="234.2988">GET /updates</text><path d="M56,222.7305 L56,247.7305 L156,247.7305 L156,232.7305 L146,222.7305 L56,222.7305 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M146,222.7305 L146,232.7305 L156,232.7305 L146,222.7305 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="62" y="240.2988">Implicit lock</text><polygon fill="#181818" points="348,270.3516,358,274.3516,348,278.3516,352,274.3516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="166" x2="354" y1="274.3516" y2="274.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="173" y="269.6094">200 OK: {Update 1, state=1}</text><path d="M29,258.041 L29,298.041 L156,298.041 L156,268.041 L146,258.041 L29,258.041 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M146,258.041 L146,268.041 L156,268.041 L146,258.041 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="35" y="275.6094">May return</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="35" y="290.9199">multiple updates</text><line style="stroke:#181818;stroke-width:1.0;" x1="370" x2="412" y1="324.9727" y2="324.9727"/><line style="stroke:#181818;stroke-width:1.0;" x1="412" x2="412" y1="324.9727" y2="337.9727"/><line style="stroke:#181818;stroke-width:1.0;" x1="371" x2="412" y1="337.9727" y2="337.9727"/><polygon fill="#181818" points="381,333.9727,371,337.9727,381,341.9727,377,337.9727" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="377" y="320.2305">process Update 1</text><polygon fill="#181818" points="177,363.2832,167,367.2832,177,371.2832,173,367.2832" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="171" x2="359" y1="367.2832" y2="367.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="183" y="362.541">DELETE /state/1/lock</text><line style="stroke:#181818;stroke-width:1.0;" x1="166" x2="208" y1="396.5938" y2="396.5938"/><line style="stroke:#181818;stroke-width:1.0;" x1="208" x2="208" y1="396.5938" y2="409.5938"/><line style="stroke:#181818;stroke-width:1.0;" x1="167" x2="208" y1="409.5938" y2="409.5938"/><polygon fill="#181818" points="177,405.5938,167,409.5938,177,413.5938,173,409.5938" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="173" y="391.8516">dequeue Update 1</text><polygon fill="#181818" points="348,434.9043,358,438.9043,348,442.9043,352,438.9043" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="166" x2="354" y1="438.9043" y2="438.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="173" y="434.1621">200 OK</text><path d="M137.75,451.9043 L137.75,476.9043 L387.75,476.9043 L387.75,461.9043 L377.75,451.9043 L137.75,451.9043 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M377.75,451.9043 L377.75,461.9043 L387.75,461.9043 L377.75,451.9043 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="154.5" y="469.4727">/state/1 may now be superseded</text><!--MD5=[b9316241c69407778d8debf60b136b06]
@startuml
'https://plantuml.com/sequence-diagram
!pragma teoz true
hide footbox

participant Gateway as gw
participant "App" as app

group operation with polling [happy]
-> gw ++: Operation 1
gw -> gw: apply Operation 1
gw -> gw - -: enqueue Update 1
...
app -> gw ++: GET /updates
activate app
note left: Implicit lock
return 200 OK: {Update 1, state=1}
note left: May return\nmultiple updates
app -> app: process Update 1
app -> gw ++: DELETE /state/1/lock
gw -> gw: dequeue Update 1
return 200 OK
deactivate app
note across: /state/1 may now be superseded
end group

@enduml

@startuml
!pragma teoz true
hide footbox

participant Gateway as gw
participant "App" as app

group operation with polling [happy]
-> gw ++: Operation 1
gw -> gw: apply Operation 1
gw -> gw - -: enqueue Update 1
...
app -> gw ++: GET /updates
activate app
note left: Implicit lock
return 200 OK: {Update 1, state=1}
note left: May return\nmultiple updates
app -> app: process Update 1
app -> gw ++: DELETE /state/1/lock
gw -> gw: dequeue Update 1
return 200 OK
deactivate app
note across: /state/1 may now be superseded
end group

@enduml

PlantUML version 1.2022.8(Sun Sep 25 10:00:33 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>