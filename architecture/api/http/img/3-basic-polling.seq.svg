<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg"
     contentStyleType="text/css" height="505px" preserveAspectRatio="none"
     style="width:519px;height:505px;background:#FFFFFF;" version="1.1" viewBox="0 0 519 505"
     width="519px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.4883" id="_title" style="stroke:none;stroke-width:1.0;" width="175" x="213" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="165" x="218" y="28.5352">Operation with Polling</text><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="142" x2="142" y1="73.9766" y2="195.9082"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="142" x2="142" y1="195.9082" y2="223.9082"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="142" x2="142" y1="223.9082" y2="498.3926"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="137" y="103.2871"/><rect fill="#FFFFFF" height="35.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="137" y="245.2188"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="137" y="373.4609"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="391" x2="391" y1="73.9766" y2="195.9082"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="391" x2="391" y1="195.9082" y2="223.9082"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="391" x2="391" y1="223.9082" y2="498.3926"/><rect fill="#FFFFFF" height="198.8633" style="stroke:#181818;stroke-width:1.0;" width="10" x="386" y="259.2188"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="71" x="106.5" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="113.5" y="63.0234">Gateway</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42" x="370" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="377" y="63.0234">App</text><polygon fill="#181818" points="125,99.2871,135,103.2871,125,107.2871,129,103.2871" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="5" x2="131" y1="103.2871" y2="103.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="12" y="98.5449">Operation 1</text><line style="stroke:#181818;stroke-width:1.0;" x1="147" x2="189" y1="132.5977" y2="132.5977"/><line style="stroke:#181818;stroke-width:1.0;" x1="189" x2="189" y1="132.5977" y2="145.5977"/><line style="stroke:#181818;stroke-width:1.0;" x1="148" x2="189" y1="145.5977" y2="145.5977"/><polygon fill="#181818" points="158,141.5977,148,145.5977,158,149.5977,154,145.5977" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="154" y="127.8555">apply Operation 1</text><line style="stroke:#181818;stroke-width:1.0;" x1="147" x2="189" y1="174.9082" y2="174.9082"/><line style="stroke:#181818;stroke-width:1.0;" x1="189" x2="189" y1="174.9082" y2="187.9082"/><line style="stroke:#181818;stroke-width:1.0;" x1="142" x2="189" y1="187.9082" y2="187.9082"/><polygon fill="#181818" points="152,183.9082,142,187.9082,152,191.9082,148,187.9082" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="154" y="170.166">enqueue Update 1</text><polygon fill="#181818" points="158,241.2188,148,245.2188,158,249.2188,154,245.2188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="152" x2="390" y1="245.2188" y2="245.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="164" y="240.4766">GET ~/state/updates</text><path d="M37,228.9082 L37,253.9082 L137,253.9082 L137,238.9082 L127,228.9082 L37,228.9082 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M127,228.9082 L127,238.9082 L137,238.9082 L127,228.9082 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="43" y="246.4766">Implicit lock</text><polygon fill="#181818" points="374,276.5293,384,280.5293,374,284.5293,378,280.5293" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147" x2="380" y1="280.5293" y2="280.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="154" y="275.7871">200 OK ETag: "1" {Update 1}</text><path d="M10,264.2188 L10,304.2188 L137,304.2188 L137,274.2188 L127,264.2188 L10,264.2188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M127,264.2188 L127,274.2188 L137,274.2188 L127,264.2188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="16" y="281.7871">May return</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="16" y="297.0977">multiple updates</text><line style="stroke:#181818;stroke-width:1.0;" x1="396" x2="438" y1="331.1504" y2="331.1504"/><line style="stroke:#181818;stroke-width:1.0;" x1="438" x2="438" y1="331.1504" y2="344.1504"/><line style="stroke:#181818;stroke-width:1.0;" x1="397" x2="438" y1="344.1504" y2="344.1504"/><polygon fill="#181818" points="407,340.1504,397,344.1504,407,348.1504,403,344.1504" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="403" y="326.4082">process Update 1</text><polygon fill="#181818" points="158,369.4609,148,373.4609,158,377.4609,154,373.4609" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="152" x2="385" y1="373.4609" y2="373.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="164" y="368.7188">DELETE ~/state/lock If-Match: "1"</text><line style="stroke:#181818;stroke-width:1.0;" x1="147" x2="189" y1="402.7715" y2="402.7715"/><line style="stroke:#181818;stroke-width:1.0;" x1="189" x2="189" y1="402.7715" y2="415.7715"/><line style="stroke:#181818;stroke-width:1.0;" x1="148" x2="189" y1="415.7715" y2="415.7715"/><polygon fill="#181818" points="158,411.7715,148,415.7715,158,419.7715,154,415.7715" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="154" y="398.0293">dequeue Update 1</text><polygon fill="#181818" points="374,441.082,384,445.082,374,449.082,378,445.082" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147" x2="380" y1="445.082" y2="445.082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="154" y="440.3398">200 OK</text><path d="M118.75,458.082 L118.75,483.082 L413.75,483.082 L413.75,468.082 L403.75,458.082 L118.75,458.082 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M403.75,458.082 L403.75,468.082 L413.75,468.082 L403.75,458.082 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="156.5" y="475.6504">ETag: "1" may now be superseded</text><!--MD5=[2ea4c248c436e0dffc7634fe0a9f583f]
@startuml
'https://plantuml.com/sequence-diagram
!pragma teoz true
hide footbox

title: Operation with Polling

participant Gateway as gw
participant "App" as app

-> gw ++: Operation 1
gw -> gw: apply Operation 1
gw -> gw - -: enqueue Update 1
...
app -> gw ++: GET \~/state/updates
activate app
note left: Implicit lock
return 200 OK ETag: "1" {Update 1}
note left: May return\nmultiple updates
app -> app: process Update 1
app -> gw ++: DELETE \~/state/lock If-Match: "1"
gw -> gw: dequeue Update 1
return 200 OK
deactivate app
note across: ETag: "1" may now be superseded

@enduml

@startuml
!pragma teoz true
hide footbox

title: Operation with Polling

participant Gateway as gw
participant "App" as app

-> gw ++: Operation 1
gw -> gw: apply Operation 1
gw -> gw - -: enqueue Update 1
...
app -> gw ++: GET \~/state/updates
activate app
note left: Implicit lock
return 200 OK ETag: "1" {Update 1}
note left: May return\nmultiple updates
app -> app: process Update 1
app -> gw ++: DELETE \~/state/lock If-Match: "1"
gw -> gw: dequeue Update 1
return 200 OK
deactivate app
note across: ETag: "1" may now be superseded

@enduml

PlantUML version 1.2022.8(Sun Sep 25 10:00:33 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>