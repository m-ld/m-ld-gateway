<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg"
     contentStyleType="text/css" height="520px" preserveAspectRatio="none"
     style="width:594px;height:520px;background:#FFFFFF;" version="1.1" viewBox="0 0 594 520"
     width="594px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.4883" id="_title" style="stroke:none;stroke-width:1.0;" width="175" x="250.5" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="165" x="255.5" y="28.5352">Operation with Polling</text><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="142" x2="142" y1="73.9766" y2="195.9082"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="142" x2="142" y1="195.9082" y2="223.9082"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="142" x2="142" y1="223.9082" y2="513.7031"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="137" y="103.2871"/><rect fill="#FFFFFF" height="35.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="137" y="245.2188"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="137" y="388.7715"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="519" x2="519" y1="73.9766" y2="195.9082"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="519" x2="519" y1="195.9082" y2="223.9082"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="519" x2="519" y1="223.9082" y2="513.7031"/><rect fill="#FFFFFF" height="214.1738" style="stroke:#181818;stroke-width:1.0;" width="10" x="514" y="259.2188"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="71" x="106.5" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="113.5" y="63.0234">Gateway</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42" x="498" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="505" y="63.0234">App</text><polygon fill="#181818" points="125,99.2871,135,103.2871,125,107.2871,129,103.2871" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="5" x2="131" y1="103.2871" y2="103.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="12" y="98.5449">Operation 1</text><line style="stroke:#181818;stroke-width:1.0;" x1="147" x2="189" y1="132.5977" y2="132.5977"/><line style="stroke:#181818;stroke-width:1.0;" x1="189" x2="189" y1="132.5977" y2="145.5977"/><line style="stroke:#181818;stroke-width:1.0;" x1="148" x2="189" y1="145.5977" y2="145.5977"/><polygon fill="#181818" points="158,141.5977,148,145.5977,158,149.5977,154,145.5977" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="154" y="127.8555">apply Operation 1</text><line style="stroke:#181818;stroke-width:1.0;" x1="147" x2="189" y1="174.9082" y2="174.9082"/><line style="stroke:#181818;stroke-width:1.0;" x1="189" x2="189" y1="174.9082" y2="187.9082"/><line style="stroke:#181818;stroke-width:1.0;" x1="142" x2="189" y1="187.9082" y2="187.9082"/><polygon fill="#181818" points="152,183.9082,142,187.9082,152,191.9082,148,187.9082" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="154" y="170.166">enqueue Update 1</text><polygon fill="#181818" points="158,241.2188,148,245.2188,158,249.2188,154,245.2188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="152" x2="518" y1="245.2188" y2="245.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="164" y="240.4766">POST ~/poll</text><path d="M37,228.9082 L37,253.9082 L137,253.9082 L137,238.9082 L127,228.9082 L37,228.9082 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M127,228.9082 L127,238.9082 L137,238.9082 L127,228.9082 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="43" y="246.4766">Implicit lock</text><polygon fill="#181818" points="502,276.5293,512,280.5293,502,284.5293,506,280.5293" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147" x2="508" y1="280.5293" y2="280.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="348" x="154" y="275.7871">201 Created ETag: "1" Location: ~/state?lock [Update 1]</text><path d="M10,264.2188 L10,304.2188 L137,304.2188 L137,274.2188 L127,264.2188 L10,264.2188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M127,264.2188 L127,274.2188 L137,274.2188 L127,264.2188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="16" y="281.7871">May return</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="16" y="297.0977">multiple updates</text><line style="stroke:#181818;stroke-width:1.0;" x1="524" x2="566" y1="346.4609" y2="346.4609"/><line style="stroke:#181818;stroke-width:1.0;" x1="566" x2="566" y1="346.4609" y2="359.4609"/><line style="stroke:#181818;stroke-width:1.0;" x1="525" x2="566" y1="359.4609" y2="359.4609"/><polygon fill="#181818" points="535,355.4609,525,359.4609,535,363.4609,531,359.4609" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="531" y="326.4082">process</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="531" y="341.7188">Update 1</text><polygon fill="#181818" points="158,384.7715,148,388.7715,158,392.7715,154,388.7715" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="152" x2="513" y1="388.7715" y2="388.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="164" y="384.0293">DELETE ~/state?lock If-Match: "1"</text><line style="stroke:#181818;stroke-width:1.0;" x1="147" x2="189" y1="418.082" y2="418.082"/><line style="stroke:#181818;stroke-width:1.0;" x1="189" x2="189" y1="418.082" y2="431.082"/><line style="stroke:#181818;stroke-width:1.0;" x1="148" x2="189" y1="431.082" y2="431.082"/><polygon fill="#181818" points="158,427.082,148,431.082,158,435.082,154,431.082" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="154" y="413.3398">dequeue Update 1</text><polygon fill="#181818" points="502,456.3926,512,460.3926,502,464.3926,506,460.3926" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147" x2="508" y1="460.3926" y2="460.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="154" y="455.6504">200 OK</text><path d="M118.75,473.3926 L118.75,498.3926 L541.75,498.3926 L541.75,483.3926 L531.75,473.3926 L118.75,473.3926 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M531.75,473.3926 L531.75,483.3926 L541.75,483.3926 L531.75,473.3926 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="220.5" y="490.9609">ETag: "1" may now be superseded</text><!--MD5=[504cf5242b1932c237a7dc17c784868d]
@startuml
'https://plantuml.com/sequence-diagram
!pragma teoz true
hide footbox

title: Operation with Polling

participant Gateway as gw
participant "App" as app

-> gw ++: Operation 1
gw -> gw: apply Operation 1
gw -> gw - -: enqueue Update 1
...
app -> gw ++: POST \~/poll
activate app
note left: Implicit lock
return 201 Created ETag: "1" Location: \~/state?lock [Update 1]
note left: May return\nmultiple updates
app -> app: process\nUpdate 1
app -> gw ++: DELETE \~/state?lock If-Match: "1"
gw -> gw: dequeue Update 1
return 200 OK
deactivate app
note across: ETag: "1" may now be superseded

@enduml

@startuml
!pragma teoz true
hide footbox

title: Operation with Polling

participant Gateway as gw
participant "App" as app

-> gw ++: Operation 1
gw -> gw: apply Operation 1
gw -> gw - -: enqueue Update 1
...
app -> gw ++: POST \~/poll
activate app
note left: Implicit lock
return 201 Created ETag: "1" Location: \~/state?lock [Update 1]
note left: May return\nmultiple updates
app -> app: process\nUpdate 1
app -> gw ++: DELETE \~/state?lock If-Match: "1"
gw -> gw: dequeue Update 1
return 200 OK
deactivate app
note across: ETag: "1" may now be superseded

@enduml

PlantUML version 1.2022.8(Sun Sep 25 10:00:33 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>