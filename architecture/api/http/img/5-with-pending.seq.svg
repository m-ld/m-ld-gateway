<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg"
     contentStyleType="text/css" height="770px" preserveAspectRatio="none"
     style="width:473px;height:770px;background:#FFFFFF;" version="1.1" viewBox="0 0 473 770"
     width="473px" zoomAndPan="magnify"><defs/><g><rect fill="#DDDDDD" height="758.252" style="stroke:#181818;stroke-width:0.5;" width="182" x="257" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="334" y="18.5684">App</text><rect fill="none" height="210.4844" style="stroke:#000000;stroke-width:1.5;" width="459" x="8" y="68.7988"/><rect fill="none" height="436.9688" style="stroke:#000000;stroke-width:1.5;" width="459" x="8" y="297.2832"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="122" x2="122" y1="56.7988" y2="758.252"/><rect fill="#FFFFFF" height="42.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="117" y="117.4199"/><rect fill="#FFFFFF" height="44.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="117" y="226.6621"/><rect fill="#FFFFFF" height="42.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="117" y="345.9043"/><rect fill="#FFFFFF" height="212.4844" style="stroke:#181818;stroke-width:1.0;" width="10" x="117" y="455.1465"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="117" y="696.9414"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="122" y="535.0781"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="122" y="593.6992"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="302" x2="302" y1="56.7988" y2="758.252"/><rect fill="#FFFFFF" height="78.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="297" y="205.3516"/><rect fill="#FFFFFF" height="305.416" style="stroke:#181818;stroke-width:1.0;" width="10" x="297" y="433.8359"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="394" x2="394" y1="56.7988" y2="758.252"/><rect fill="#FFFFFF" height="137.5527" style="stroke:#181818;stroke-width:1.0;" width="10" x="389" y="146.7305"/><rect fill="#FFFFFF" height="260.7949" style="stroke:#181818;stroke-width:1.0;" width="10" x="389" y="375.2148"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="71" x="86.5" y="25.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="93.5" y="45.8457">Gateway</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="82" x="261" y="25.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="268" y="45.8457">(thread 1)</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="82" x="353" y="25.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="360" y="45.8457">(thread 2)</text><path d="M8,68.7988 L240,68.7988 L240,76.1094 L230,86.1094 L8,86.1094 L8,68.7988 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="210.4844" style="stroke:#000000;stroke-width:1.5;" width="459" x="8" y="68.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="183" x="23" y="82.3672">POST to state with pending</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="41" x="255" y="81.4336">[happy]</text><polygon fill="#181818" points="105,113.4199,115,117.4199,105,121.4199,109,117.4199" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="5" x2="111" y1="117.4199" y2="117.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="12" y="112.6777">Operation 1</text><polygon fill="#181818" points="377,142.7305,387,146.7305,377,150.7305,381,146.7305" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="383" y1="146.7305" y2="146.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="134" y="141.9883">POST /webhook?state=1</text><path d="M342,159.7305 L342,199.7305 L446,199.7305 L446,169.7305 L436,159.7305 L342,159.7305 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M436,159.7305 L436,169.7305 L446,169.7305 L436,159.7305 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="348" y="177.2988">Update being</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="348" y="192.6094">processed</text><polygon fill="#181818" points="138,222.6621,128,226.6621,138,230.6621,134,226.6621" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="132" x2="296" y1="226.6621" y2="226.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="144" y="221.9199">POST /state/0 { ... }</text><polygon fill="#181818" points="285,267.2832,295,271.2832,285,275.2832,289,271.2832" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="127" x2="291" y1="271.2832" y2="271.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="134" y="251.2305">404 Not Found</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="134" y="266.541">(Update 1 is pending)</text><path d="M8,297.2832 L208,297.2832 L208,304.5938 L198,314.5938 L8,314.5938 L8,297.2832 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="436.9688" style="stroke:#000000;stroke-width:1.5;" width="459" x="8" y="297.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151" x="23" y="310.8516">POST to wildcard state</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="41" x="223" y="309.918">[happy]</text><polygon fill="#181818" points="105,341.9043,115,345.9043,105,349.9043,109,345.9043" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="5" x2="111" y1="345.9043" y2="345.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="12" y="341.1621">Operation 1</text><polygon fill="#181818" points="377,371.2148,387,375.2148,377,379.2148,381,375.2148" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="127" x2="383" y1="375.2148" y2="375.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="134" y="370.4727">POST /webhook?state=1</text><path d="M342,388.2148 L342,428.2148 L446,428.2148 L446,398.2148 L436,388.2148 L342,388.2148 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M436,388.2148 L436,398.2148 L446,398.2148 L436,388.2148 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="348" y="405.7832">Update being</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="348" y="421.0938">processed</text><polygon fill="#181818" points="138,451.1465,128,455.1465,138,459.1465,134,455.1465" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="132" x2="296" y1="455.1465" y2="455.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="144" y="450.4043">POST /state { ... }</text><path d="M52.5,468.1465 L52.5,508.1465 L191.5,508.1465 L191.5,478.1465 L181.5,468.1465 L52.5,468.1465 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M181.5,468.1465 L181.5,478.1465 L191.5,478.1465 L181.5,468.1465 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="58.5" y="485.7148">write is delayed</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="58.5" y="501.0254">by pending Update</text><polygon fill="#181818" points="143,531.0781,133,535.0781,143,539.0781,139,535.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="137" x2="388" y1="535.0781" y2="535.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="149" y="530.3359">GET /updates</text><polygon fill="#181818" points="377,560.3887,387,564.3887,377,568.3887,381,564.3887" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="132" x2="383" y1="564.3887" y2="564.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="139" y="559.6465">200 OK: Update 1</text><polygon fill="#181818" points="143,589.6992,133,593.6992,143,597.6992,139,593.6992" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="137" x2="388" y1="593.6992" y2="593.6992"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="149" y="588.957">DELETE /state/1/lock</text><polygon fill="#181818" points="377,619.0098,387,623.0098,377,627.0098,381,623.0098" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="132" x2="383" y1="623.0098" y2="623.0098"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="139" y="618.2676">200 OK</text><polygon fill="#181818" points="285,663.6309,295,667.6309,285,671.6309,289,667.6309" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="127" x2="291" y1="667.6309" y2="667.6309"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="134" y="647.5781">200 OK: Update 2</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="13" x="134" y="662.8887">or</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="151" y="662.8887">408 Request Timeout</text><polygon fill="#181818" points="138,692.9414,128,696.9414,138,700.9414,134,696.9414" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="132" x2="296" y1="696.9414" y2="696.9414"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="144" y="692.1992">DELETE /state/2/lock</text><polygon fill="#181818" points="285,722.252,295,726.252,285,730.252,289,726.252" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="127" x2="291" y1="726.252" y2="726.252"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="134" y="721.5098">200 OK</text><!--MD5=[bbf8a64f91ea7964cf30f82262788a87]
@startuml
'https://plantuml.com/sequence-diagram
!pragma teoz true
hide footbox

participant Gateway as gw
box App
participant "(thread 1)" as app
participant "(thread 2)" as app2
end box

group POST to state with pending [happy]
-> gw ++: Operation 1
gw -> app2 ++- -: POST /webhook?state=1
note over app2: Update being\nprocessed
activate app
app -> gw ++: POST /state/0 { ... }
return 404 Not Found\n(Update 1 is pending)
deactivate app
deactivate app2
end group

group POST to wildcard state [happy]
-> gw ++: Operation 1
gw -> app2 ++- -: POST /webhook?state=1
note over app2: Update being\nprocessed
activate app
app -> gw ++: POST /state { ... }
note over gw
write is delayed
by pending Update
end note
app2 -> gw ++: GET /updates
return 200 OK: Update 1
app2 -> gw ++: DELETE /state/1/lock
return 200 OK
deactivate app2
gw - -> app: 200 OK: Update 2\n//or// 408 Request Timeout
deactivate gw
app -> gw ++: DELETE /state/2/lock
return 200 OK
deactivate app
end group

@enduml

@startuml
!pragma teoz true
hide footbox

participant Gateway as gw
box App
participant "(thread 1)" as app
participant "(thread 2)" as app2
end box

group POST to state with pending [happy]
-> gw ++: Operation 1
gw -> app2 ++- -: POST /webhook?state=1
note over app2: Update being\nprocessed
activate app
app -> gw ++: POST /state/0 { ... }
return 404 Not Found\n(Update 1 is pending)
deactivate app
deactivate app2
end group

group POST to wildcard state [happy]
-> gw ++: Operation 1
gw -> app2 ++- -: POST /webhook?state=1
note over app2: Update being\nprocessed
activate app
app -> gw ++: POST /state { ... }
note over gw
write is delayed
by pending Update
end note
app2 -> gw ++: GET /updates
return 200 OK: Update 1
app2 -> gw ++: DELETE /state/1/lock
return 200 OK
deactivate app2
gw - -> app: 200 OK: Update 2\n//or// 408 Request Timeout
deactivate gw
app -> gw ++: DELETE /state/2/lock
return 200 OK
deactivate app
end group

@enduml

PlantUML version 1.2022.8(Sun Sep 25 10:00:33 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>