<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg"
     contentStyleType="text/css" height="402px" preserveAspectRatio="none"
     style="width:548px;height:402px;background:#FFFFFF;" version="1.1" viewBox="0 0 548 402"
     width="548px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="323.416" style="stroke:#000000;stroke-width:1.5;" width="534" x="8" y="48.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="194" x2="194" y1="36.4883" y2="395.9043"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="189" y="97.1094"/><rect fill="#FFFFFF" height="123.5527" style="stroke:#181818;stroke-width:1.0;" width="10" x="189" y="240.3516"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="398" x2="398" y1="36.4883" y2="395.9043"/><rect fill="#FFFFFF" height="301.1055" style="stroke:#181818;stroke-width:1.0;" width="10" x="393" y="75.7988"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="71" x="158.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="165.5" y="25.5352">Gateway</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42" x="377" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="384" y="25.5352">App</text><path d="M8,48.4883 L91,48.4883 L91,55.7988 L81,65.7988 L8,65.7988 L8,48.4883 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="323.416" style="stroke:#000000;stroke-width:1.5;" width="534" x="8" y="48.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="34" x="23" y="62.0566">write</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="41" x="106" y="61.123">[happy]</text><polygon fill="#181818" points="210,93.1094,200,97.1094,210,101.1094,206,97.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="204" x2="392" y1="97.1094" y2="97.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="216" y="92.3672">POST /state/1 { ... }</text><line style="stroke:#181818;stroke-width:1.0;" x1="199" x2="241" y1="126.4199" y2="126.4199"/><line style="stroke:#181818;stroke-width:1.0;" x1="241" x2="241" y1="126.4199" y2="139.4199"/><line style="stroke:#181818;stroke-width:1.0;" x1="200" x2="241" y1="139.4199" y2="139.4199"/><polygon fill="#181818" points="210,135.4199,200,139.4199,210,143.4199,206,139.4199" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="206" y="121.6777">enqueue Update 1</text><polygon fill="#181818" points="381,164.7305,391,168.7305,381,172.7305,385,168.7305" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="199" x2="387" y1="168.7305" y2="168.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="206" y="163.9883">200 OK: {Update 1, state=1}</text><polygon fill="#181818" points="16,164.7305,6,168.7305,16,172.7305,12,168.7305" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="10" x2="193" y1="168.7305" y2="168.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="22" y="163.9883">Operation 1</text><line style="stroke:#181818;stroke-width:1.0;" x1="403" x2="445" y1="198.041" y2="198.041"/><line style="stroke:#181818;stroke-width:1.0;" x1="445" x2="445" y1="198.041" y2="211.041"/><line style="stroke:#181818;stroke-width:1.0;" x1="404" x2="445" y1="211.041" y2="211.041"/><polygon fill="#181818" points="414,207.041,404,211.041,414,215.041,410,211.041" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="410" y="193.2988">process Update 1</text><polygon fill="#181818" points="210,236.3516,200,240.3516,210,244.3516,206,240.3516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="204" x2="392" y1="240.3516" y2="240.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="216" y="235.6094">DELETE /state/1/lock</text><path d="M29,224.041 L29,295.041 L189,295.041 L189,234.041 L179,224.041 L29,224.041 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M179,224.041 L179,234.041 L189,234.041 L179,224.041 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="35" y="241.6094">Update deletion is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="21" x="153" y="241.6094">not</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="35" y="256.9199">like ACID commit -</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="35" y="272.2305">operation has already</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="35" y="287.541">been sent</text><line style="stroke:#181818;stroke-width:1.0;" x1="199" x2="241" y1="321.5938" y2="321.5938"/><line style="stroke:#181818;stroke-width:1.0;" x1="241" x2="241" y1="321.5938" y2="334.5938"/><line style="stroke:#181818;stroke-width:1.0;" x1="200" x2="241" y1="334.5938" y2="334.5938"/><polygon fill="#181818" points="210,330.5938,200,334.5938,210,338.5938,206,334.5938" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="206" y="316.8516">dequeue Update 1</text><polygon fill="#181818" points="381,359.9043,391,363.9043,381,367.9043,385,363.9043" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="199" x2="387" y1="363.9043" y2="363.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="206" y="359.1621">200 OK</text><!--MD5=[f18a914457a74b9fa9768cecf7c79bfc]
@startuml
'https://plantuml.com/sequence-diagram
!pragma teoz true
hide footbox

participant Gateway as gw
participant "App" as app

group write [happy]
activate app
app -> gw ++: POST /state/1 { ... }
gw -> gw: enqueue Update 1
return 200 OK: {Update 1, state=1}
& <- gw: Operation 1
app -> app: process Update 1
app -> gw ++: DELETE /state/1/lock
note left
Update deletion is //not//
like ACID commit -
operation has already
been sent
end note
gw -> gw: dequeue Update 1
return 200 OK
deactivate app
end group

@enduml

@startuml
!pragma teoz true
hide footbox

participant Gateway as gw
participant "App" as app

group write [happy]
activate app
app -> gw ++: POST /state/1 { ... }
gw -> gw: enqueue Update 1
return 200 OK: {Update 1, state=1}
& <- gw: Operation 1
app -> app: process Update 1
app -> gw ++: DELETE /state/1/lock
note left
Update deletion is //not//
like ACID commit -
operation has already
been sent
end note
gw -> gw: dequeue Update 1
return 200 OK
deactivate app
end group

@enduml

PlantUML version 1.2022.8(Sun Sep 25 10:00:33 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>