<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg"
     contentStyleType="text/css" height="395px" preserveAspectRatio="none"
     style="width:571px;height:395px;background:#FFFFFF;" version="1.1" viewBox="0 0 571 395"
     width="571px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.4883" id="_title" style="stroke:none;stroke-width:1.0;" width="90" x="242.5" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="80" x="247.5" y="28.5352">Basic Write</text><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="194" x2="194" y1="73.9766" y2="388.082"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="189" y="103.2871"/><rect fill="#FFFFFF" height="123.5527" style="stroke:#181818;stroke-width:1.0;" width="10" x="189" y="246.5293"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="443" x2="443" y1="73.9766" y2="388.082"/><rect fill="#FFFFFF" height="301.1055" style="stroke:#181818;stroke-width:1.0;" width="10" x="438" y="81.9766"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="71" x="158.5" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="165.5" y="63.0234">Gateway</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42" x="422" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="429" y="63.0234">App</text><polygon fill="#181818" points="210,99.2871,200,103.2871,210,107.2871,206,103.2871" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="204" x2="437" y1="103.2871" y2="103.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="216" y="98.5449">POST ~/state { ... }</text><line style="stroke:#181818;stroke-width:1.0;" x1="199" x2="241" y1="132.5977" y2="132.5977"/><line style="stroke:#181818;stroke-width:1.0;" x1="241" x2="241" y1="132.5977" y2="145.5977"/><line style="stroke:#181818;stroke-width:1.0;" x1="200" x2="241" y1="145.5977" y2="145.5977"/><polygon fill="#181818" points="210,141.5977,200,145.5977,210,149.5977,206,145.5977" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="206" y="127.8555">enqueue Update 1</text><polygon fill="#181818" points="426,170.9082,436,174.9082,426,178.9082,430,174.9082" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="199" x2="432" y1="174.9082" y2="174.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="206" y="170.166">200 OK ETag: "1" {Update 1}</text><polygon fill="#181818" points="16,170.9082,6,174.9082,16,178.9082,12,174.9082" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="10" x2="193" y1="174.9082" y2="174.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="22" y="170.166">Operation 1 &lt;&lt;publish&gt;&gt;</text><line style="stroke:#181818;stroke-width:1.0;" x1="448" x2="490" y1="204.2188" y2="204.2188"/><line style="stroke:#181818;stroke-width:1.0;" x1="490" x2="490" y1="204.2188" y2="217.2188"/><line style="stroke:#181818;stroke-width:1.0;" x1="449" x2="490" y1="217.2188" y2="217.2188"/><polygon fill="#181818" points="459,213.2188,449,217.2188,459,221.2188,455,217.2188" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="455" y="199.4766">process Update 1</text><polygon fill="#181818" points="210,242.5293,200,246.5293,210,250.5293,206,246.5293" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="204" x2="437" y1="246.5293" y2="246.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="216" y="241.7871">DELETE ~/state/lock If-Match: "1"</text><path d="M29,230.2188 L29,301.2188 L189,301.2188 L189,240.2188 L179,230.2188 L29,230.2188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M179,230.2188 L179,240.2188 L189,240.2188 L179,230.2188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="35" y="247.7871">Update deletion is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="21" x="153" y="247.7871">not</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="35" y="263.0977">like ACID commit -</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="35" y="278.4082">operation has already</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="35" y="293.7188">been sent</text><line style="stroke:#181818;stroke-width:1.0;" x1="199" x2="241" y1="327.7715" y2="327.7715"/><line style="stroke:#181818;stroke-width:1.0;" x1="241" x2="241" y1="327.7715" y2="340.7715"/><line style="stroke:#181818;stroke-width:1.0;" x1="200" x2="241" y1="340.7715" y2="340.7715"/><polygon fill="#181818" points="210,336.7715,200,340.7715,210,344.7715,206,340.7715" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="206" y="323.0293">dequeue Update 1</text><polygon fill="#181818" points="426,366.082,436,370.082,426,374.082,430,370.082" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="199" x2="432" y1="370.082" y2="370.082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="206" y="365.3398">200 OK</text><!--MD5=[533b3de1c5c0c3477ed43dd06cd4fee1]
@startuml
'https://plantuml.com/sequence-diagram
!pragma teoz true
hide footbox

title: Basic Write

participant Gateway as gw
participant "App" as app

activate app
app -> gw ++: POST \~/state { ... }
gw -> gw: enqueue Update 1
'Note that other operations on the domain can happen independently
return 200 OK ETag: "1" {Update 1}
& <- gw: Operation 1 <<publish>>
app -> app: process Update 1
app -> gw ++: DELETE \~/state/lock If-Match: "1"
note left
Update deletion is //not//
like ACID commit -
operation has already
been sent
end note
gw -> gw: dequeue Update 1
return 200 OK
deactivate app

@enduml

@startuml
!pragma teoz true
hide footbox

title: Basic Write

participant Gateway as gw
participant "App" as app

activate app
app -> gw ++: POST \~/state { ... }
gw -> gw: enqueue Update 1
return 200 OK ETag: "1" {Update 1}
& <- gw: Operation 1 <<publish>>
app -> app: process Update 1
app -> gw ++: DELETE \~/state/lock If-Match: "1"
note left
Update deletion is //not//
like ACID commit -
operation has already
been sent
end note
gw -> gw: dequeue Update 1
return 200 OK
deactivate app

@enduml

PlantUML version 1.2022.8(Sun Sep 25 10:00:33 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>