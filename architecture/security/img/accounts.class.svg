<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="645px" preserveAspectRatio="none" style="width:1211px;height:645px;background:#FFFFFF;" version="1.1" viewBox="0 0 1211 645" width="1211px" zoomAndPan="magnify"><defs/><g><!--MD5=[6de492f04047ff8a778df2bea690e363]
class Gateway--><g id="elem_Gateway"><rect codeLine="6" fill="#F1F1F1" height="103.7305" id="Gateway" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="165" x="358" y="7"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="55" x="413" y="23.6016">«domain»</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="52" x="414.5" y="37.7344">«service»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="412" y="53.8008">Gateway</text><line style="stroke:#181818;stroke-width:0.5;" x1="359" x2="522" y1="61.7539" y2="61.7539"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153" x="364" y="79.2891">rootAccount : Account</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="364" y="95.7773">rootKey : AuthKey</text><line style="stroke:#181818;stroke-width:0.5;" x1="359" x2="522" y1="102.7305" y2="102.7305"/></g><!--MD5=[f9a29335b499db729be669fd1bd54958]
class Account--><g id="elem_Account"><rect codeLine="13" fill="#F1F1F1" height="153.1953" id="Account" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="280" x="300.5" y="233.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="59" x="411" y="250.1016">«abstract»</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="54" x="413.5" y="264.2344">«subject»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="412.5" y="280.3008">Account</text><line style="stroke:#181818;stroke-width:0.5;" x1="301.5" x2="579.5" y1="288.2539" y2="288.2539"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="306.5" y="305.7891">email : string [1..*]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="306.5" y="322.2773">key : UserKey [*]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="188" x="306.5" y="338.7656">subdomain : Subdomain [*]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196" x="306.5" y="355.2539">naming : any | uuid [*] = any</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="268" x="306.5" y="371.7422">remotesAuth : anon | key | jwt [*] = key</text><line style="stroke:#181818;stroke-width:0.5;" x1="301.5" x2="579.5" y1="378.6953" y2="378.6953"/></g><path d="M615.5,188 L615.5,204.3105 L433.5,300.498 L615.5,212.3105 L615.5,228.6211 A0,0 0 0 0 615.5,228.6211 L778.5,228.6211 A0,0 0 0 0 778.5,228.6211 L778.5,198 L768.5,188 L615.5,188 A0,0 0 0 0 615.5,188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M768.5,188 L768.5,198 L778.5,198 L768.5,188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="621.5" y="205.5684">Registered email, used</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="621.5" y="220.8789">for account activation</text><path d="M615.5,238.6211 L615.5,277.8975 L502.5,349.9629 L615.5,285.8975 L615.5,325.1738 A0,0 0 0 0 615.5,325.1738 L825.5,325.1738 A0,0 0 0 0 825.5,325.1738 L825.5,248.6211 L815.5,238.6211 L615.5,238.6211 A0,0 0 0 0 615.5,238.6211 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M815.5,238.6211 L815.5,248.6211 L825.5,248.6211 L815.5,238.6211 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="621.5" y="255.8657">any</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="649.5" y="256.1895">naming requires an app</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="621.5" y="271.5">to PUT (sub)domain names.</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="32" x="621.5" y="286.4868">uuid</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="657.5" y="286.8105">naming allows any UUID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="621.5" y="302.1211">(sub)domain name, or</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="621.5" y="317.4316">generate with POST.</text><path d="M615.5,335.1738 L615.5,374.4502 L574.5,366.4512 L615.5,382.4502 L615.5,421.7266 A0,0 0 0 0 615.5,421.7266 L786.5,421.7266 A0,0 0 0 0 786.5,421.7266 L786.5,345.1738 L776.5,335.1738 L615.5,335.1738 A0,0 0 0 0 615.5,335.1738 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M776.5,335.1738 L776.5,345.1738 L786.5,345.1738 L776.5,335.1738 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="621.5" y="352.7422">Allowed remote</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="621.5" y="368.0527">authentication methods</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="621.5" y="383.3633">for subdomain clones.</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="32" x="621.5" y="398.3501">anon</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="657.5" y="398.6738">auth only works</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="621.5" y="413.9844">with</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="32" x="652.5" y="413.6606">uuid</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="688.5" y="413.9844">subdomains</text><!--MD5=[48c89f8a025853fc7772f4a7999a1407]
class Subdomain--><g id="elem_Subdomain"><rect codeLine="46" fill="#F1F1F1" height="103.7305" id="Subdomain" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="177" x="7" y="517"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="55" x="68" y="533.6016">«domain»</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="54" x="68.5" y="547.7344">«subject»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78" x="56.5" y="563.8008">Subdomain</text><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="183" y1="571.7539" y2="571.7539"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="122" x="13" y="589.2891">account : Account</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="165" x="13" y="605.7773">useSignatures : boolean</text><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="183" y1="612.7305" y2="612.7305"/></g><!--MD5=[fee662a292a0353a69bd162820bae93b]
entity User--><g id="elem_User"><ellipse cx="772.5" cy="29.5" fill="#F1F1F1" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M772.5,37.5 L772.5,64.5 M759.5,45.5 L785.5,45.5 M772.5,64.5 L759.5,79.5 M772.5,64.5 L785.5,79.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="699.5" y="94.5352">User (account owner)</text></g><!--MD5=[169298fcae047c920cb45c646344fdd7]
class AuthKey--><g id="elem_AuthKey"><rect codeLine="88" fill="#F1F1F1" height="106.0859" id="AuthKey" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="861" y="257"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="47" x="890" y="273.6016">«secret»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="885" y="289.668">AuthKey</text><line style="stroke:#181818;stroke-width:0.5;" x1="862" x2="965" y1="297.6211" y2="297.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="867" y="315.1563">keyid : string</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="867" y="331.6445">appid : string</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="867" y="348.1328">secret : string</text><line style="stroke:#181818;stroke-width:0.5;" x1="862" x2="965" y1="355.0859" y2="355.0859"/></g><g id="elem_GMN13"><path d="M18,274.5 L18,345.7422 A0,0 0 0 0 18,345.7422 L91.5,345.7422 L95.5,516.62 L99.5,345.7422 L173,345.7422 A0,0 0 0 0 173,345.7422 L173,284.5 L163,274.5 L18,274.5 A0,0 0 0 0 18,274.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M163,274.5 L163,284.5 L173,284.5 L163,274.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="24" y="292.0684">a subject in the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="24" y="307.3789">Gateway domain;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="24" y="322.6895">also a domain shared</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="24" y="338">to authorised clients</text></g><path d="M219.5,510.5 L219.5,526.8105 L135,583.998 L219.5,534.8105 L219.5,551.1211 A0,0 0 0 0 219.5,551.1211 L366.5,551.1211 A0,0 0 0 0 366.5,551.1211 L366.5,520.5 L356.5,510.5 L219.5,510.5 A0,0 0 0 0 219.5,510.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M356.5,510.5 L356.5,520.5 L366.5,520.5 L356.5,510.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="225.5" y="528.0684">entailed from</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="225.5" y="543.3789">Account.subdomain</text><path d="M219.5,561.1211 L219.5,585.0869 L178,600.4863 L219.5,593.0869 L219.5,617.0527 A0,0 0 0 0 219.5,617.0527 L403.5,617.0527 A0,0 0 0 0 403.5,617.0527 L403.5,571.1211 L393.5,561.1211 L219.5,561.1211 A0,0 0 0 0 219.5,561.1211 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M393.5,561.1211 L393.5,571.1211 L403.5,571.1211 L393.5,561.1211 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="225.5" y="578.6895">If true, transport security</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="225.5" y="594">is activated and all clones</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="225.5" y="609.3105">must initialise with it</text><!--MD5=[033b72a131f47407b9f0b55998f42021]
class UserKey--><g id="elem_UserKey"><rect codeLine="66" fill="#F1F1F1" height="139.0625" id="UserKey" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="187" x="439" y="499.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="54" x="505.5" y="516.1016">«subject»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="505" y="532.168">UserKey</text><line style="stroke:#181818;stroke-width:0.5;" x1="440" x2="625" y1="540.1211" y2="540.1211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="445" y="557.6563">@id =</text><text fill="#000000" font-family="monospace" font-size="14" lengthAdjust="spacing" textLength="88" x="489" y="557.3076">".${keyid}"</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="445" y="574.1445">name? : string</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170" x="445" y="590.6328">publicKey : base64Binary</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="175" x="445" y="607.1211">privateKey : base64Binary</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="445" y="623.6094">revoked? : boolean</text><line style="stroke:#181818;stroke-width:0.5;" x1="440" x2="625" y1="630.5625" y2="630.5625"/></g><path d="M661,493 L661,509.3105 L541,568.8535 L661,517.3105 L661,533.6211 A0,0 0 0 0 661,533.6211 L816,533.6211 A0,0 0 0 0 816,533.6211 L816,503 L806,493 L661,493 A0,0 0 0 0 661,493 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M806,493 L806,503 L816,503 L806,493 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="667" y="510.5684">account@≪gateway≫</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="667" y="525.8789">Not present in config</text><path d="M661,543.6211 L661,552.2764 L620,601.8301 L661,560.2764 L661,568.9316 A0,0 0 0 0 661,568.9316 L831,568.9316 A0,0 0 0 0 831,568.9316 L831,553.6211 L821,543.6211 L661,543.6211 A0,0 0 0 0 661,543.6211 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M821,543.6211 L821,553.6211 L831,553.6211 L821,543.6211 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="667" y="561.1895">Encrypted with AuthKey</text><path d="M661,578.9316 L661,602.8975 L574,618.3184 L661,610.8975 L661,634.8633 A0,0 0 0 0 661,634.8633 L836,634.8633 A0,0 0 0 0 836,634.8633 L836,588.9316 L826,578.9316 L661,578.9316 A0,0 0 0 0 661,578.9316 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M826,578.9316 L826,588.9316 L836,588.9316 L826,578.9316 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="667" y="596.5">possibly redundant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="667" y="611.8105">with external keystore</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="667" y="627.1211">Assumed</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="32" x="729" y="626.7974">true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="765" y="627.1211">in config</text><g id="elem_GMN22"><path d="M1001,274.5 L1001,306 L966.29,310 L1001,314 L1001,345.7422 A0,0 0 0 0 1001,345.7422 L1204,345.7422 A0,0 0 0 0 1204,345.7422 L1204,284.5 L1194,274.5 L1001,274.5 A0,0 0 0 0 1001,274.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1194,274.5 L1194,284.5 L1204,284.5 L1194,274.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="1007" y="292.0684">String-serialised "API key"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="1007" y="307.3789">Usable with Basic HTTP auth.</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="48" x="1007" y="322.3657">secret</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1059" y="322.6895">content is not</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="1007" y="338">known to the Gateway.</text></g><!--MD5=[194d4a8dfc1f1dbb24ee205902653cbe]
reverse link Gateway to Account--><g id="link_Gateway_Account"><path codeLine="11" d="M440.5,124.56 C440.5,157.78 440.5,198.49 440.5,233.19 " fill="none" id="Gateway-backto-Account" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="440.5,111.29,436.5,117.29,440.5,123.29,444.5,117.29,440.5,111.29" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="6" x="434.2141" y="222.7281">*</text></g><!--MD5=[25992f23a227de57e085562c6ccaa08b]
reverse link Account to Subdomain--><g id="link_Account_Subdomain"><path codeLine="39" d="M328.15,394.69 C274.01,435.02 210.82,482.09 163.98,516.99 " fill="none" id="Account-backto-Subdomain" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="338.85,386.72,331.6491,387.1026,329.2326,393.8968,336.4336,393.5142,338.85,386.72" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="6" x="167.1881" y="506.2306">*</text></g><!--MD5=[87e802f94dff5db0b14b612664619da8]
link User to Account--><g id="link_User_Account"><path codeLine="43" d="M720.95,97.19 C685.96,122.55 638.74,157.04 597.5,188 C579.46,201.54 560.37,216.08 541.95,230.22 " fill="none" id="User-to-Account" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="537.78,233.42,547.3529,231.1048,541.7437,230.3721,542.4763,224.7629,537.78,233.42" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="661.5" y="154.5684">has</text></g><!--MD5=[c7ffa2fa11327cf2ce82e85887dc3256]
link User to AuthKey--><g id="link_User_AuthKey"><path codeLine="44" d="M793.46,97.01 C816.64,137.96 854.29,204.44 881.24,252.03 " fill="none" id="User-to-AuthKey" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="883.82,256.58,882.8695,246.7771,881.3578,252.2283,875.9067,250.7166,883.82,256.58" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="827.5" y="154.5684">has</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="6" x="873.6329" y="246.3574">*</text></g><!--MD5=[339a8c0793e1cd681a39b8b7b3c791e5]
reverse link Account to UserKey--><g id="link_Account_UserKey"><path codeLine="86" d="M472.03,399.08 C483.77,431.88 496.91,468.59 507.94,499.39 " fill="none" id="Account-backto-UserKey" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="467.61,386.72,465.8678,393.7175,471.6569,398.017,473.3991,391.0195,467.61,386.72" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="461.8127" y="407.3211">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="6" x="498.9256" y="488.538">*</text></g><!--MD5=[cfda96a854204d24e414dedee76deceb]
@startuml
'https://plantuml.com/class-diagram

hide circle
allowmixing

class Gateway <<domain>> <<service>> {
  rootAccount : Account
  rootKey : AuthKey
}

Gateway *- - "*" Account

class Account <<abstract>> <<subject>> {
  email : string [1..*]
  key : UserKey [*]
  subdomain : Subdomain [*]
  naming : any | uuid [*] = any
  remotesAuth : anon | key | jwt [*] = key
}
note right of Account::email
  Registered email, used
  for account activation
end note
note right of Account::naming
 ""any"" naming requires an app
 to PUT (sub)domain names.
 ""uuid"" naming allows any UUID
 (sub)domain name, or
 generate with POST.
end note
note right of Account::remotesAuth
  Allowed remote
  authentication methods
  for subdomain clones.
  ""anon"" auth only works
  with ""uuid"" subdomains
end note

Account *- - "*" Subdomain

actor "User (account owner)" as User

User ..> Account: has
User ..> "*" AuthKey: has

class Subdomain <<domain>> <<subject>> {
  //account : Account//
  useSignatures : boolean
}
note top of Subdomain
  a subject in the
  Gateway domain;
  also a domain shared
  to authorised clients
end note
note right of Subdomain::account
  entailed from
  Account.subdomain
end note
note right of Subdomain::useSignatures
  If true, transport security
  is activated and all clones
  must initialise with it
end note

class UserKey <<subject>> {
  @id = """.${keyid}" ""
  name? : string
  publicKey : base64Binary
  privateKey : base64Binary
  revoked? : boolean
}
note right of UserKey::name
  account@≪gateway≫
  Not present in config
end note
note right of UserKey::privateKey
  Encrypted with AuthKey
end note
note right of UserKey::revoked
  possibly redundant
  with external keystore
  Assumed ""true"" in config
end note

Account "1" *- - "*" UserKey

class AuthKey <<secret>> {
  keyid : string
  appid : string
  secret : string
}
note right of AuthKey
  String-serialised "API key"
  Usable with Basic HTTP auth.
  ""secret"" content is not
  known to the Gateway.
end note

@enduml

@startuml

hide circle
allowmixing

class Gateway <<domain>> <<service>> {
  rootAccount : Account
  rootKey : AuthKey
}

Gateway *- - "*" Account

class Account <<abstract>> <<subject>> {
  email : string [1..*]
  key : UserKey [*]
  subdomain : Subdomain [*]
  naming : any | uuid [*] = any
  remotesAuth : anon | key | jwt [*] = key
}
note right of Account::email
  Registered email, used
  for account activation
end note
note right of Account::naming
 ""any"" naming requires an app
 to PUT (sub)domain names.
 ""uuid"" naming allows any UUID
 (sub)domain name, or
 generate with POST.
end note
note right of Account::remotesAuth
  Allowed remote
  authentication methods
  for subdomain clones.
  ""anon"" auth only works
  with ""uuid"" subdomains
end note

Account *- - "*" Subdomain

actor "User (account owner)" as User

User ..> Account: has
User ..> "*" AuthKey: has

class Subdomain <<domain>> <<subject>> {
  //account : Account//
  useSignatures : boolean
}
note top of Subdomain
  a subject in the
  Gateway domain;
  also a domain shared
  to authorised clients
end note
note right of Subdomain::account
  entailed from
  Account.subdomain
end note
note right of Subdomain::useSignatures
  If true, transport security
  is activated and all clones
  must initialise with it
end note

class UserKey <<subject>> {
  @id = """.${keyid}" ""
  name? : string
  publicKey : base64Binary
  privateKey : base64Binary
  revoked? : boolean
}
note right of UserKey::name
  account@≪gateway≫
  Not present in config
end note
note right of UserKey::privateKey
  Encrypted with AuthKey
end note
note right of UserKey::revoked
  possibly redundant
  with external keystore
  Assumed ""true"" in config
end note

Account "1" *- - "*" UserKey

class AuthKey <<secret>> {
  keyid : string
  appid : string
  secret : string
}
note right of AuthKey
  String-serialised "API key"
  Usable with Basic HTTP auth.
  ""secret"" content is not
  known to the Gateway.
end note

@enduml

PlantUML version 1.2022.8(Sun Sep 25 10:00:33 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>