<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="718px" preserveAspectRatio="none" style="width:1228px;height:718px;background:#FFFFFF;" version="1.1" viewBox="0 0 1228 718" width="1228px" zoomAndPan="magnify"><defs/><g><!--MD5=[6de492f04047ff8a778df2bea690e363]
class Gateway--><g id="elem_Gateway"><rect codeLine="6" fill="#F1F1F1" height="103.7305" id="Gateway" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="196" x="279" y="159.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="55" x="349.5" y="176.1016">«domain»</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="52" x="351" y="190.2344">«service»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="348.5" y="206.3008">Gateway</text><line style="stroke:#181818;stroke-width:0.5;" x1="280" x2="474" y1="214.2539" y2="214.2539"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="184" x="285" y="231.7891">rootAccount : UserAccount</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="285" y="248.2773">rootKey : AuthKey</text><line style="stroke:#181818;stroke-width:0.5;" x1="280" x2="474" y1="255.2305" y2="255.2305"/></g><!--MD5=[f9a29335b499db729be669fd1bd54958]
class Account--><g id="elem_Account"><rect codeLine="13" fill="#F1F1F1" height="120.2188" id="Account" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="280" x="181" y="372"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="59" x="291.5" y="388.6016">«abstract»</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="54" x="294" y="402.7344">«subject»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="293" y="418.8008">Account</text><line style="stroke:#181818;stroke-width:0.5;" x1="182" x2="460" y1="426.7539" y2="426.7539"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="188" x="187" y="444.2891">subdomain : Subdomain [*]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196" x="187" y="460.7773">naming : any | uuid [*] = any</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="268" x="187" y="477.2656">remotesAuth : anon | key | jwt [*] = key</text><line style="stroke:#181818;stroke-width:0.5;" x1="182" x2="460" y1="484.2188" y2="484.2188"/></g><path d="M496,325.5 L496,341.8105 L375,438.998 L496,349.8105 L496,366.1211 A0,0 0 0 0 496,366.1211 L658,366.1211 A0,0 0 0 0 658,366.1211 L658,335.5 L648,325.5 L496,325.5 A0,0 0 0 0 496,325.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M648,325.5 L648,335.5 L658,335.5 L648,325.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="502" y="343.0684">A Subdomain can only</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="502" y="358.3789">appear in one Account</text><path d="M496,376.1211 L496,415.3975 L383,455.4863 L496,423.3975 L496,462.6738 A0,0 0 0 0 496,462.6738 L706,462.6738 A0,0 0 0 0 706,462.6738 L706,386.1211 L696,376.1211 L496,376.1211 A0,0 0 0 0 496,376.1211 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M696,376.1211 L696,386.1211 L706,386.1211 L696,376.1211 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="502" y="393.3657">any</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="530" y="393.6895">naming requires an app</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="502" y="409">to PUT (sub)domain names.</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="32" x="502" y="423.9868">uuid</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="538" y="424.3105">naming allows any UUID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="502" y="439.6211">(sub)domain name, or</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="502" y="454.9316">generate with POST.</text><path d="M496,472.6738 L496,496.6396 L455,471.9746 L496,504.6396 L496,528.6055 A0,0 0 0 0 496,528.6055 L667,528.6055 A0,0 0 0 0 667,528.6055 L667,482.6738 L657,472.6738 L496,472.6738 A0,0 0 0 0 496,472.6738 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M657,472.6738 L657,482.6738 L667,482.6738 L657,472.6738 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="502" y="490.2422">Allowed remote</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="502" y="505.5527">authentication methods</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="502" y="520.8633">for subdomain clones.</text><path d="M6,406.5 L6,447.1211 A0,0 0 0 0 6,447.1211 L146,447.1211 A0,0 0 0 0 146,447.1211 L146,430.8105 L185,471.9746 L146,422.8105 L146,416.5 L136,406.5 L6,406.5 A0,0 0 0 0 6,406.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M136,406.5 L136,416.5 L146,416.5 L136,406.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="32" x="12" y="423.7446">anon</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="48" y="424.0684">auth requires</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="32" x="12" y="439.0552">uuid</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="48" y="439.3789">subdomains</text><!--MD5=[48c89f8a025853fc7772f4a7999a1407]
class Subdomain--><g id="elem_Subdomain"><rect codeLine="64" fill="#F1F1F1" height="106.7305" id="Subdomain" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="177" x="232.5" y="604.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="55" x="293.5" y="621.1016">«domain»</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="54" x="294" y="635.2344">«subject»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78" x="282" y="651.3008">Subdomain</text><line style="stroke:#181818;stroke-width:0.5;" x1="233.5" x2="408.5" y1="659.2539" y2="659.2539"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="54" x="238.5" y="676.7891">account</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacing" textLength="7" x="292.5" y="680.4219">p</text><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="64" x="303.5" y="676.7891">: Account</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="165" x="238.5" y="696.2773">useSignatures : boolean</text><line style="stroke:#181818;stroke-width:0.5;" x1="233.5" x2="408.5" y1="703.2305" y2="703.2305"/></g><!--MD5=[fee662a292a0353a69bd162820bae93b]
entity User--><g id="elem_User"><ellipse cx="856" cy="14" fill="#F1F1F1" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M856,22 L856,49 M843,30 L869,30 M856,49 L843,64 M856,49 L869,64 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="840.5" y="79.0352">User</text></g><!--MD5=[873670755c6433d3512a8b316aa6820d]
class UserAccount--><g id="elem_UserAccount"><rect codeLine="43" fill="#F1F1F1" height="89.5977" id="UserAccount" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="139" x="708.5" y="166.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="54" x="751" y="183.1016">«subject»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="734.5" y="199.168">UserAccount</text><line style="stroke:#181818;stroke-width:0.5;" x1="709.5" x2="846.5" y1="207.1211" y2="207.1211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="714.5" y="224.6563">email : string [1..*]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="714.5" y="241.1445">key : UserKey [*]</text><line style="stroke:#181818;stroke-width:0.5;" x1="709.5" x2="846.5" y1="248.0977" y2="248.0977"/></g><path d="M510.5,186 L510.5,226.6211 A0,0 0 0 0 510.5,226.6211 L673.5,226.6211 A0,0 0 0 0 673.5,226.6211 L673.5,210.3105 L712.5,219.3652 L673.5,202.3105 L673.5,196 L663.5,186 L510.5,186 A0,0 0 0 0 510.5,186 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M663.5,186 L663.5,196 L673.5,196 L663.5,186 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="516.5" y="203.5684">Registered email, used</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="516.5" y="218.8789">for account activation</text><!--MD5=[169298fcae047c920cb45c646344fdd7]
class AuthKey--><g id="elem_AuthKey"><rect codeLine="106" fill="#F1F1F1" height="106.0859" id="AuthKey" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="882.5" y="158.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="47" x="911.5" y="175.1016">«secret»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="906.5" y="191.168">AuthKey</text><line style="stroke:#181818;stroke-width:0.5;" x1="883.5" x2="986.5" y1="199.1211" y2="199.1211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="888.5" y="216.6563">keyid : string</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="888.5" y="233.1445">appid : string</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="888.5" y="249.6328">secret : string</text><line style="stroke:#181818;stroke-width:0.5;" x1="883.5" x2="986.5" y1="256.5859" y2="256.5859"/></g><!--MD5=[f5f68a7b4d1daa3f868d0f655b773560]
class OrganisationAccount--><g id="elem_OrganisationAccount"><rect codeLine="55" fill="#F1F1F1" height="73.1094" id="OrganisationAccount" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="303" x="198.5" y="7"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="54" x="323" y="23.6016">«subject»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145" x="277.5" y="39.668">OrganisationAccount</text><line style="stroke:#181818;stroke-width:0.5;" x1="199.5" x2="500.5" y1="47.6211" y2="47.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="291" x="204.5" y="65.1563">vf:primaryAccountable : UserAccount [1..*]</text><line style="stroke:#181818;stroke-width:0.5;" x1="199.5" x2="500.5" y1="72.1094" y2="72.1094"/></g><path d="M537,26 L537,34.6553 L495.5,59.8652 L537,42.6553 L537,51.3105 A0,0 0 0 0 537,51.3105 L695,51.3105 A0,0 0 0 0 695,51.3105 L695,36 L685,26 L537,26 A0,0 0 0 0 537,26 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M685,26 L685,36 L695,36 L685,26 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="543" y="43.5684">The account "admins"</text><g id="elem_GMN24"><path d="M42.5,622.5 L42.5,693.7422 A0,0 0 0 0 42.5,693.7422 L197.5,693.7422 A0,0 0 0 0 197.5,693.7422 L197.5,662 L232.4,658 L197.5,654 L197.5,632.5 L187.5,622.5 L42.5,622.5 A0,0 0 0 0 42.5,622.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M187.5,622.5 L187.5,632.5 L197.5,632.5 L187.5,622.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="48.5" y="640.0684">a subject in the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="48.5" y="655.3789">Gateway domain;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="48.5" y="670.6895">also a domain shared</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="48.5" y="686">to authorised clients</text></g><path d="M445,599.5 L445,615.8105 L367.5,672.998 L445,623.8105 L445,640.1211 A0,0 0 0 0 445,640.1211 L592,640.1211 A0,0 0 0 0 592,640.1211 L592,609.5 L582,599.5 L445,599.5 A0,0 0 0 0 445,599.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M582,599.5 L582,609.5 L592,609.5 L582,599.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="451" y="617.0684">entailed from</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="451" y="632.3789">Account.subdomain</text><path d="M445,650.1211 L445,674.0869 L403.5,690.9863 L445,682.0869 L445,706.0527 A0,0 0 0 0 445,706.0527 L629,706.0527 A0,0 0 0 0 629,706.0527 L629,660.1211 L619,650.1211 L445,650.1211 A0,0 0 0 0 445,650.1211 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M619,650.1211 L619,660.1211 L629,660.1211 L619,650.1211 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="451" y="667.6895">If true, transport security</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="451" y="683">is activated and all clones</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="451" y="698.3105">must initialise with it</text><!--MD5=[033b72a131f47407b9f0b55998f42021]
class UserKey--><g id="elem_UserKey"><rect codeLine="84" fill="#F1F1F1" height="139.0625" id="UserKey" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="187" x="741.5" y="362.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="54" x="808" y="379.1016">«subject»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="807.5" y="395.168">UserKey</text><line style="stroke:#181818;stroke-width:0.5;" x1="742.5" x2="927.5" y1="403.1211" y2="403.1211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="747.5" y="420.6563">@id =</text><text fill="#000000" font-family="monospace" font-size="14" lengthAdjust="spacing" textLength="88" x="791.5" y="420.3076">".${keyid}"</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="747.5" y="437.1445">name? : string</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170" x="747.5" y="453.6328">publicKey : base64Binary</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="175" x="747.5" y="470.1211">privateKey : base64Binary</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="747.5" y="486.6094">revoked? : boolean</text><line style="stroke:#181818;stroke-width:0.5;" x1="742.5" x2="927.5" y1="493.5625" y2="493.5625"/></g><path d="M963.5,354.5 L963.5,372.3105 L843.5,431.8535 L963.5,380.3105 L963.5,398.1211 A0,0 0 0 0 963.5,398.1211 L1121.5,398.1211 A0,0 0 0 0 1121.5,398.1211 L1121.5,364.5 L1111.5,354.5 L963.5,354.5 A0,0 0 0 0 963.5,354.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1111.5,354.5 L1111.5,364.5 L1121.5,364.5 L1111.5,354.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="969.5" y="372.0684">account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="1019.5" y="375.7012">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="1025.5" y="372.0684">@≪gateway≫</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="969.5" y="390.3789">Not present in config</text><path d="M963.5,408.1211 L963.5,416.7764 L922.5,464.8301 L963.5,424.7764 L963.5,433.4316 A0,0 0 0 0 963.5,433.4316 L1133.5,433.4316 A0,0 0 0 0 1133.5,433.4316 L1133.5,418.1211 L1123.5,408.1211 L963.5,408.1211 A0,0 0 0 0 963.5,408.1211 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1123.5,408.1211 L1123.5,418.1211 L1133.5,418.1211 L1123.5,408.1211 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="969.5" y="425.6895">Encrypted with AuthKey</text><path d="M963.5,443.4316 L963.5,467.3975 L876.5,481.3184 L963.5,475.3975 L963.5,499.3633 A0,0 0 0 0 963.5,499.3633 L1138.5,499.3633 A0,0 0 0 0 1138.5,499.3633 L1138.5,453.4316 L1128.5,443.4316 L963.5,443.4316 A0,0 0 0 0 963.5,443.4316 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1128.5,443.4316 L1128.5,453.4316 L1138.5,453.4316 L1128.5,443.4316 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="969.5" y="461">possibly redundant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="969.5" y="476.3105">with external keystore</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="969.5" y="491.6211">Assumed</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="32" x="1031.5" y="491.2974">true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="1067.5" y="491.6211">in config</text><g id="elem_GMN33"><path d="M1022.5,191 L1022.5,207.5 L987.59,211.5 L1022.5,215.5 L1022.5,231.6211 A0,0 0 0 0 1022.5,231.6211 L1221.5,231.6211 A0,0 0 0 0 1221.5,231.6211 L1221.5,201 L1211.5,191 L1022.5,191 A0,0 0 0 0 1022.5,191 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1211.5,191 L1211.5,201 L1221.5,201 L1211.5,191 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="1028.5" y="208.5684">String-serialised "API key"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="1028.5" y="223.8789">Usable with Basic HTTP auth</text></g><!--MD5=[194d4a8dfc1f1dbb24ee205902653cbe]
reverse link Gateway to Account--><g id="link_Gateway_Account"><path codeLine="11" d="M360.54,276.71 C352.82,306.84 343.68,342.52 336.13,371.98 " fill="none" id="Gateway-backto-Account" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="363.87,263.73,358.5046,268.5479,360.8882,275.3536,366.2537,270.5357,363.87,263.73" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="6" x="331.6083" y="361.325">*</text></g><!--MD5=[25992f23a227de57e085562c6ccaa08b]
reverse link Account to Subdomain--><g id="link_Account_Subdomain"><path codeLine="39" d="M321,505.17 C321,537.46 321,574.82 321,604.41 " fill="none" id="Account-backto-Subdomain" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="321,492.15,317,498.15,321,504.15,325,498.15,321,492.15" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="6" x="314.5969" y="593.8084">*</text></g><!--MD5=[008ba0f0b6901373239fc7803ec7bfb5]
link UserAccount to Account--><g id="link_UserAccount_Account"><path codeLine="51" d="M708.07,256.37 C702.38,259.29 696.65,262.05 691,264.5 C601.06,303.53 567.94,284.23 479,325.5 C457.84,335.32 436.3,347.77 416.22,360.64 " fill="none" id="UserAccount-to-Account" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="419.92,366.59,399.37,371.76,412.21,354.91,419.92,366.59" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[378c3c1b132e255188f7374dad2a45ac]
link User to UserAccount--><g id="link_User_UserAccount"><path codeLine="52" d="M840.4,77.69 C829.1,101.75 813.63,134.67 800.92,161.72 " fill="none" id="User-to-UserAccount" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="798.75,166.35,806.1985,159.9064,800.8769,161.8249,798.9584,156.5033,798.75,166.35" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="824" y="125.0684">has</text></g><!--MD5=[c7ffa2fa11327cf2ce82e85887dc3256]
link User to AuthKey--><g id="link_User_AuthKey"><path codeLine="53" d="M871.61,77.3 C881.98,99.09 895.87,128.28 908.01,153.78 " fill="none" id="User-to-AuthKey" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="910.25,158.49,910.0041,148.6442,908.1059,153.9731,902.777,152.0748,910.25,158.49" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="896" y="125.0684">has</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="6" x="900.5211" y="147.9424">*</text></g><!--MD5=[3bd2f785ce7fba86ff840f78f2677824]
link OrganisationAccount to Account--><g id="link_OrganisationAccount_Account"><path codeLine="61" d="M311.96,80.19 C292.67,100.95 271.21,128.82 261,158.5 C238.93,222.63 258.94,298.11 281.61,353.35 " fill="none" id="OrganisationAccount-to-Account" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="288.16,350.86,289.67,371.99,275.31,356.41,288.16,350.86" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[3e3ddf26659482ebc6db1edb96e472ec]
reverse link OrganisationAccount to UserAccount--><g id="link_OrganisationAccount_UserAccount"><path codeLine="62" d="M490.78,84.05 C553.3,103.51 627.06,129.12 691,158.5 C696.76,161.14 702.61,164.07 708.43,167.16 " fill="none" id="OrganisationAccount-backto-UserAccount" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="478.02,80.11,482.5688,85.7054,489.4833,83.6585,484.9345,78.0631,478.02,80.11" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="678.4989" y="159.6604">1..*</text></g><!--MD5=[da11c875fea71f40e71ed49095cfc482]
reverse link UserAccount to UserKey--><g id="link_UserAccount_UserKey"><path codeLine="104" d="M792.82,269.31 C800.24,297.74 809.28,332.4 817.08,362.32 " fill="none" id="UserAccount-backto-UserKey" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="789.53,256.72,787.1681,263.5333,792.5489,268.3341,794.9108,261.5207,789.53,256.72" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="782.5889" y="276.7522">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="6" x="808.9226" y="351.942">*</text></g><!--MD5=[4c98ccac8e1a025abdb4e482b2cb293b]
@startuml
'https://plantuml.com/class-diagram

hide circle
allowmixing

class Gateway <<domain>> <<service>> {
  rootAccount : UserAccount
  rootKey : AuthKey
}

Gateway *- - "*" Account

class Account <<abstract>> <<subject>> {
  subdomain : Subdomain [*]
  naming : any | uuid [*] = any
  remotesAuth : anon | key | jwt [*] = key
}
note right of Account::subdomain
  A Subdomain can only
  appear in one Account
end note
note right of Account::naming
 ""any"" naming requires an app
 to PUT (sub)domain names.
 ""uuid"" naming allows any UUID
 (sub)domain name, or
 generate with POST.
end note
note right of Account::remotesAuth
  Allowed remote
  authentication methods
  for subdomain clones.
end note
note left of Account::remotesAuth
  ""anon"" auth requires
  ""uuid"" subdomains
end note

Account *- - "*" Subdomain

actor User

class UserAccount <<subject>> {
  email : string [1..*]
  key : UserKey [*]
}
note left of UserAccount::email
  Registered email, used
  for account activation
end note
UserAccount - -|> Account
User ..> UserAccount: has
User ..> "*" AuthKey: has

class OrganisationAccount <<subject>> {
  vf:primaryAccountable : UserAccount [1..*]
}
note right of OrganisationAccount::vf:primaryAccountable
  The account "admins"
end note
OrganisationAccount - -|> Account
OrganisationAccount o- - "1..*" UserAccount

class Subdomain <<domain>> <<subject>> {
  //account<sub>p</sub> : Account//
  useSignatures : boolean
}
note left of Subdomain
  a subject in the
  Gateway domain;
  also a domain shared
  to authorised clients
end note
note right of Subdomain::account
  entailed from
  Account.subdomain
end note
note right of Subdomain::useSignatures
  If true, transport security
  is activated and all clones
  must initialise with it
end note

class UserKey <<subject>> {
  @id = """.${keyid}" ""
  name? : string
  publicKey : base64Binary
  privateKey : base64Binary
  revoked? : boolean
}
note right of UserKey::name
  account<sub>u</sub>@≪gateway≫
  Not present in config
end note
note right of UserKey::privateKey
  Encrypted with AuthKey
end note
note right of UserKey::revoked
  possibly redundant
  with external keystore
  Assumed ""true"" in config
end note

UserAccount "1" *- - "*" UserKey

class AuthKey <<secret>> {
  keyid : string
  appid : string
  secret : string
}
note right of AuthKey
  String-serialised "API key"
  Usable with Basic HTTP auth
end note

@enduml

@startuml

hide circle
allowmixing

class Gateway <<domain>> <<service>> {
  rootAccount : UserAccount
  rootKey : AuthKey
}

Gateway *- - "*" Account

class Account <<abstract>> <<subject>> {
  subdomain : Subdomain [*]
  naming : any | uuid [*] = any
  remotesAuth : anon | key | jwt [*] = key
}
note right of Account::subdomain
  A Subdomain can only
  appear in one Account
end note
note right of Account::naming
 ""any"" naming requires an app
 to PUT (sub)domain names.
 ""uuid"" naming allows any UUID
 (sub)domain name, or
 generate with POST.
end note
note right of Account::remotesAuth
  Allowed remote
  authentication methods
  for subdomain clones.
end note
note left of Account::remotesAuth
  ""anon"" auth requires
  ""uuid"" subdomains
end note

Account *- - "*" Subdomain

actor User

class UserAccount <<subject>> {
  email : string [1..*]
  key : UserKey [*]
}
note left of UserAccount::email
  Registered email, used
  for account activation
end note
UserAccount - -|> Account
User ..> UserAccount: has
User ..> "*" AuthKey: has

class OrganisationAccount <<subject>> {
  vf:primaryAccountable : UserAccount [1..*]
}
note right of OrganisationAccount::vf:primaryAccountable
  The account "admins"
end note
OrganisationAccount - -|> Account
OrganisationAccount o- - "1..*" UserAccount

class Subdomain <<domain>> <<subject>> {
  //account<sub>p</sub> : Account//
  useSignatures : boolean
}
note left of Subdomain
  a subject in the
  Gateway domain;
  also a domain shared
  to authorised clients
end note
note right of Subdomain::account
  entailed from
  Account.subdomain
end note
note right of Subdomain::useSignatures
  If true, transport security
  is activated and all clones
  must initialise with it
end note

class UserKey <<subject>> {
  @id = """.${keyid}" ""
  name? : string
  publicKey : base64Binary
  privateKey : base64Binary
  revoked? : boolean
}
note right of UserKey::name
  account<sub>u</sub>@≪gateway≫
  Not present in config
end note
note right of UserKey::privateKey
  Encrypted with AuthKey
end note
note right of UserKey::revoked
  possibly redundant
  with external keystore
  Assumed ""true"" in config
end note

UserAccount "1" *- - "*" UserKey

class AuthKey <<secret>> {
  keyid : string
  appid : string
  secret : string
}
note right of AuthKey
  String-serialised "API key"
  Usable with Basic HTTP auth
end note

@enduml

PlantUML version 1.2022.8(Sun Sep 25 10:00:33 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>