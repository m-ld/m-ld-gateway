<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="742px" preserveAspectRatio="none" style="width:1146px;height:742px;background:#FFFFFF;" version="1.1" viewBox="0 0 1146 742" width="1146px" zoomAndPan="magnify"><defs/><g><!--MD5=[6de492f04047ff8a778df2bea690e363]
class Gateway--><g id="elem_Gateway"><rect codeLine="6" fill="#F1F1F1" height="103.7305" id="Gateway" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="196" x="196.5" y="159.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="55" x="267" y="176.1016">«domain»</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="52" x="268.5" y="190.2344">«service»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="266" y="206.3008">Gateway</text><line style="stroke:#181818;stroke-width:0.5;" x1="197.5" x2="391.5" y1="214.2539" y2="214.2539"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="184" x="202.5" y="231.7891">rootAccount : UserAccount</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="202.5" y="248.2773">rootKey : AuthKey</text><line style="stroke:#181818;stroke-width:0.5;" x1="197.5" x2="391.5" y1="255.2305" y2="255.2305"/></g><!--MD5=[f9a29335b499db729be669fd1bd54958]
class Account--><g id="elem_Account"><rect codeLine="13" fill="#F1F1F1" height="120.2188" id="Account" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="280" x="126.5" y="395"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="59" x="237" y="411.6016">«abstract»</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="54" x="239.5" y="425.7344">«subject»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="238.5" y="441.8008">Account</text><line style="stroke:#181818;stroke-width:0.5;" x1="127.5" x2="405.5" y1="449.7539" y2="449.7539"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="188" x="132.5" y="467.2891">subdomain : Subdomain [*]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196" x="132.5" y="483.7773">naming : any | uuid [*] = any</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="268" x="132.5" y="500.2656">remotesAuth : anon | key | jwt [*] = key</text><line style="stroke:#181818;stroke-width:0.5;" x1="127.5" x2="405.5" y1="507.2188" y2="507.2188"/></g><path d="M441.5,325.5 L441.5,341.8105 L320.5,461.998 L441.5,349.8105 L441.5,366.1211 A0,0 0 0 0 441.5,366.1211 L603.5,366.1211 A0,0 0 0 0 603.5,366.1211 L603.5,335.5 L593.5,325.5 L441.5,325.5 A0,0 0 0 0 441.5,325.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M593.5,325.5 L593.5,335.5 L603.5,335.5 L593.5,325.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="447.5" y="343.0684">A Subdomain can only</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="447.5" y="358.3789">appear in one Account</text><path d="M441.5,376.1211 L441.5,423.0527 L328.5,478.4863 L441.5,431.0527 L441.5,477.9844 A0,0 0 0 0 441.5,477.9844 L647.5,477.9844 A0,0 0 0 0 647.5,477.9844 L647.5,386.1211 L637.5,376.1211 L441.5,376.1211 A0,0 0 0 0 441.5,376.1211 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M637.5,376.1211 L637.5,386.1211 L647.5,386.1211 L637.5,376.1211 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="22" x="447.5" y="393.6895">any</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="473.5" y="393.6895">naming requires an app</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="447.5" y="409">to PUT (sub)domain names.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="28" x="447.5" y="424.3105">uuid</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="479.5" y="424.3105">naming allows any UUID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="447.5" y="439.6211">(sub)domain name, or</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="447.5" y="454.9316">generate with POST.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="447.5" y="470.2422">Other options may be added.</text><path d="M441.5,487.9844 L441.5,527.2607 L400.5,494.9746 L441.5,535.2607 L441.5,574.5371 A0,0 0 0 0 441.5,574.5371 L617.5,574.5371 A0,0 0 0 0 617.5,574.5371 L617.5,497.9844 L607.5,487.9844 L441.5,487.9844 A0,0 0 0 0 441.5,487.9844 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M607.5,487.9844 L607.5,497.9844 L617.5,497.9844 L607.5,487.9844 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="447.5" y="505.5527">Allowed remote</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="447.5" y="520.8633">authentication methods</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="447.5" y="536.1738">for subdomain clones.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="447.5" y="551.4844">Named subdomains may</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="447.5" y="566.7949">override (in future).</text><!--MD5=[48c89f8a025853fc7772f4a7999a1407]
class Subdomain--><g id="elem_Subdomain"><rect codeLine="63" fill="#F1F1F1" height="90.2422" id="Subdomain" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="141" x="196" y="645.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="55" x="239" y="662.1016">«domain»</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="54" x="239.5" y="676.2344">«subject»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78" x="227.5" y="692.3008">Subdomain</text><line style="stroke:#181818;stroke-width:0.5;" x1="197" x2="336" y1="700.2539" y2="700.2539"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="54" x="202" y="717.7891">account</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacing" textLength="7" x="256" y="721.4219">p</text><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="64" x="267" y="717.7891">: Account</text><line style="stroke:#181818;stroke-width:0.5;" x1="197" x2="336" y1="727.7422" y2="727.7422"/></g><!--MD5=[fee662a292a0353a69bd162820bae93b]
entity User--><g id="elem_User"><ellipse cx="773.5" cy="14" fill="#F1F1F1" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M773.5,22 L773.5,49 M760.5,30 L786.5,30 M773.5,49 L760.5,64 M773.5,49 L786.5,64 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="758" y="79.0352">User</text></g><!--MD5=[873670755c6433d3512a8b316aa6820d]
class UserAccount--><g id="elem_UserAccount"><rect codeLine="42" fill="#F1F1F1" height="89.5977" id="UserAccount" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="139" x="626" y="166.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="54" x="668.5" y="183.1016">«subject»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="652" y="199.168">UserAccount</text><line style="stroke:#181818;stroke-width:0.5;" x1="627" x2="764" y1="207.1211" y2="207.1211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="632" y="224.6563">email : string [1..*]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="632" y="241.1445">key : UserKey [*]</text><line style="stroke:#181818;stroke-width:0.5;" x1="627" x2="764" y1="248.0977" y2="248.0977"/></g><path d="M428,186 L428,226.6211 A0,0 0 0 0 428,226.6211 L591,226.6211 A0,0 0 0 0 591,226.6211 L591,210.3105 L630,219.3652 L591,202.3105 L591,196 L581,186 L428,186 A0,0 0 0 0 428,186 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M581,186 L581,196 L591,196 L581,186 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="434" y="203.5684">Registered email, used</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="434" y="218.8789">for account activation</text><!--MD5=[169298fcae047c920cb45c646344fdd7]
class AuthKey--><g id="elem_AuthKey"><rect codeLine="101" fill="#F1F1F1" height="106.0859" id="AuthKey" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="800" y="158.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="47" x="829" y="175.1016">«secret»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="824" y="191.168">AuthKey</text><line style="stroke:#181818;stroke-width:0.5;" x1="801" x2="904" y1="199.1211" y2="199.1211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="806" y="216.6563">keyid : string</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="806" y="233.1445">appid : string</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="806" y="249.6328">secret : string</text><line style="stroke:#181818;stroke-width:0.5;" x1="801" x2="904" y1="256.5859" y2="256.5859"/></g><!--MD5=[f5f68a7b4d1daa3f868d0f655b773560]
class OrganisationAccount--><g id="elem_OrganisationAccount"><rect codeLine="54" fill="#F1F1F1" height="73.1094" id="OrganisationAccount" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="303" x="116" y="7"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="54" x="240.5" y="23.6016">«subject»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145" x="195" y="39.668">OrganisationAccount</text><line style="stroke:#181818;stroke-width:0.5;" x1="117" x2="418" y1="47.6211" y2="47.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="291" x="122" y="65.1563">vf:primaryAccountable : UserAccount [1..*]</text><line style="stroke:#181818;stroke-width:0.5;" x1="117" x2="418" y1="72.1094" y2="72.1094"/></g><path d="M454.5,26 L454.5,34.6553 L413,59.8652 L454.5,42.6553 L454.5,51.3105 A0,0 0 0 0 454.5,51.3105 L612.5,51.3105 A0,0 0 0 0 612.5,51.3105 L612.5,36 L602.5,26 L454.5,26 A0,0 0 0 0 454.5,26 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M602.5,26 L602.5,36 L612.5,36 L602.5,26 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="460.5" y="43.5684">The account "admins"</text><g id="elem_GMN22"><path d="M6,655 L6,726.2422 A0,0 0 0 0 6,726.2422 L161,726.2422 A0,0 0 0 0 161,726.2422 L161,694.5 L195.66,690.5 L161,686.5 L161,665 L151,655 L6,655 A0,0 0 0 0 6,655 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M151,655 L151,665 L161,665 L151,655 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="12" y="672.5684">a subject in the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="12" y="687.8789">Gateway domain;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="12" y="703.1895">also a domain shared</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="12" y="718.5">to authorised clients</text></g><path d="M372,665 L372,681.3105 L331,713.998 L372,689.3105 L372,705.6211 A0,0 0 0 0 372,705.6211 L519,705.6211 A0,0 0 0 0 519,705.6211 L519,675 L509,665 L372,665 A0,0 0 0 0 372,665 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M509,665 L509,675 L519,675 L509,665 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="378" y="682.5684">entailed from</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="378" y="697.8789">Account.subdomain</text><!--MD5=[033b72a131f47407b9f0b55998f42021]
class UserKey--><g id="elem_UserKey"><rect codeLine="79" fill="#F1F1F1" height="139.0625" id="UserKey" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="187" x="683" y="385.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="54" x="749.5" y="402.1016">«subject»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="749" y="418.168">UserKey</text><line style="stroke:#181818;stroke-width:0.5;" x1="684" x2="869" y1="426.1211" y2="426.1211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="689" y="443.6563">@id =</text><text fill="#000000" font-family="monospace" font-size="14" lengthAdjust="spacing" textLength="88" x="733" y="443.3076">".${keyid}"</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="689" y="460.1445">name? : string</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170" x="689" y="476.6328">publicKey : base64Binary</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="175" x="689" y="493.1211">privateKey : base64Binary</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="689" y="509.6094">revoked? : boolean</text><line style="stroke:#181818;stroke-width:0.5;" x1="684" x2="869" y1="516.5625" y2="516.5625"/></g><path d="M905,377.5 L905,395.3105 L785,454.8535 L905,403.3105 L905,421.1211 A0,0 0 0 0 905,421.1211 L1063,421.1211 A0,0 0 0 0 1063,421.1211 L1063,387.5 L1053,377.5 L905,377.5 A0,0 0 0 0 905,377.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1053,377.5 L1053,387.5 L1063,387.5 L1053,377.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="911" y="395.0684">account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="961" y="398.7012">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="967" y="395.0684">@≪gateway≫</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="911" y="413.3789">Not present in config</text><path d="M905,431.1211 L905,439.7764 L864,487.8301 L905,447.7764 L905,456.4316 A0,0 0 0 0 905,456.4316 L1075,456.4316 A0,0 0 0 0 1075,456.4316 L1075,441.1211 L1065,431.1211 L905,431.1211 A0,0 0 0 0 905,431.1211 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1065,431.1211 L1065,441.1211 L1075,441.1211 L1065,431.1211 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="911" y="448.6895">Encrypted with AuthKey</text><path d="M905,466.4316 L905,490.3975 L818,504.3184 L905,498.3975 L905,522.3633 A0,0 0 0 0 905,522.3633 L1080,522.3633 A0,0 0 0 0 1080,522.3633 L1080,476.4316 L1070,466.4316 L905,466.4316 A0,0 0 0 0 905,466.4316 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1070,466.4316 L1070,476.4316 L1080,476.4316 L1070,466.4316 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="911" y="484">possibly redundant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="911" y="499.3105">with external keystore</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="911" y="514.6211">Assumed</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="32" x="973" y="514.2974">true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="1009" y="514.6211">in config</text><g id="elem_GMN31"><path d="M940,191 L940,207.5 L905.09,211.5 L940,215.5 L940,231.6211 A0,0 0 0 0 940,231.6211 L1139,231.6211 A0,0 0 0 0 1139,231.6211 L1139,201 L1129,191 L940,191 A0,0 0 0 0 940,191 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1129,191 L1129,201 L1139,201 L1129,191 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="946" y="208.5684">String-serialised "API key"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="946" y="223.8789">Usable with Basic HTTP auth</text></g><!--MD5=[194d4a8dfc1f1dbb24ee205902653cbe]
reverse link Gateway to Account--><g id="link_Gateway_Account"><path codeLine="11" d="M287.05,276.78 C282.8,313.42 277.51,359.01 273.37,394.78 " fill="none" id="Gateway-backto-Account" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="288.56,263.72,283.9005,269.2235,287.1885,275.6414,291.848,270.1378,288.56,263.72" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="6" x="267.8417" y="384.1006">*</text></g><!--MD5=[25992f23a227de57e085562c6ccaa08b]
reverse link Account to Subdomain--><g id="link_Account_Subdomain"><path codeLine="38" d="M266.5,528.43 C266.5,566.73 266.5,612.51 266.5,645.45 " fill="none" id="Account-backto-Subdomain" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="266.5,515.22,262.5,521.22,266.5,527.22,270.5,521.22,266.5,515.22" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="6" x="260.0219" y="634.6487">*</text></g><!--MD5=[008ba0f0b6901373239fc7803ec7bfb5]
link UserAccount to Account--><g id="link_UserAccount_Account"><path codeLine="50" d="M625.94,255.86 C620.12,258.94 614.26,261.86 608.5,264.5 C530.17,300.37 500.05,284.09 424.5,325.5 C396.4,340.91 368.39,361.51 343.93,381.71 " fill="none" id="UserAccount-to-Account" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="348.19,387.27,328.4,394.86,339.14,376.59,348.19,387.27" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[378c3c1b132e255188f7374dad2a45ac]
link User to UserAccount--><g id="link_User_UserAccount"><path codeLine="51" d="M757.9,77.69 C746.6,101.75 731.13,134.67 718.42,161.72 " fill="none" id="User-to-UserAccount" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="716.25,166.35,723.6985,159.9064,718.3769,161.8249,716.4584,156.5033,716.25,166.35" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="741.5" y="125.0684">has</text></g><!--MD5=[c7ffa2fa11327cf2ce82e85887dc3256]
link User to AuthKey--><g id="link_User_AuthKey"><path codeLine="52" d="M789.11,77.3 C799.48,99.09 813.37,128.28 825.51,153.78 " fill="none" id="User-to-AuthKey" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="827.75,158.49,827.5041,148.6442,825.6059,153.9731,820.277,152.0748,827.75,158.49" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="813.5" y="125.0684">has</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="6" x="818.0211" y="147.9424">*</text></g><!--MD5=[3bd2f785ce7fba86ff840f78f2677824]
link OrganisationAccount to Account--><g id="link_OrganisationAccount_Account"><path codeLine="60" d="M229.46,80.19 C210.17,100.95 188.71,128.82 178.5,158.5 C153.2,232.01 184.93,317.21 217.12,377.19 " fill="none" id="OrganisationAccount-to-Account" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="223.4,374.08,227.06,394.95,211.19,380.92,223.4,374.08" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[3e3ddf26659482ebc6db1edb96e472ec]
reverse link OrganisationAccount to UserAccount--><g id="link_OrganisationAccount_UserAccount"><path codeLine="61" d="M408.28,84.05 C470.8,103.51 544.56,129.12 608.5,158.5 C614.26,161.14 620.11,164.07 625.93,167.16 " fill="none" id="OrganisationAccount-backto-UserAccount" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="395.52,80.11,400.0688,85.7054,406.9833,83.6585,402.4345,78.0631,395.52,80.11" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="595.9989" y="159.6604">1..*</text></g><!--MD5=[da11c875fea71f40e71ed49095cfc482]
reverse link UserAccount to UserKey--><g id="link_UserAccount_UserKey"><path codeLine="99" d="M714.54,269.28 C726.17,303.94 741.11,348.5 753.41,385.16 " fill="none" id="UserAccount-backto-UserKey" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="710.26,256.51,708.3796,263.4716,714.0824,267.8849,715.9628,260.9233,710.26,256.51" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="703.7731" y="276.5127">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="6" x="744.7195" y="374.7655">*</text></g><!--MD5=[807a983db4e5ae64e0ce9173c03ad2ea]
@startuml
'https://plantuml.com/class-diagram

hide circle
allowmixing

class Gateway <<domain>> <<service>> {
  rootAccount : UserAccount
  rootKey : AuthKey
}

Gateway *- - "*" Account

class Account <<abstract>> <<subject>> {
  subdomain : Subdomain [*]
  naming : any | uuid [*] = any
  remotesAuth : anon | key | jwt [*] = key
}
note right of Account::subdomain
  A Subdomain can only
  appear in one Account
end note
note right of Account::naming
 //any// naming requires an app
 to PUT (sub)domain names.
 //uuid// naming allows any UUID
 (sub)domain name, or
 generate with POST.
 Other options may be added.
end note
note right of Account::remotesAuth
  Allowed remote
  authentication methods
  for subdomain clones.
  Named subdomains may
  override (in future).
end note

Account *- - "*" Subdomain

actor User

class UserAccount <<subject>> {
  email : string [1..*]
  key : UserKey [*]
}
note left of UserAccount::email
  Registered email, used
  for account activation
end note
UserAccount - -|> Account
User ..> UserAccount: has
User ..> "*" AuthKey: has

class OrganisationAccount <<subject>> {
  vf:primaryAccountable : UserAccount [1..*]
}
note right of OrganisationAccount::vf:primaryAccountable
  The account "admins"
end note
OrganisationAccount - -|> Account
OrganisationAccount o- - "1..*" UserAccount

class Subdomain <<domain>> <<subject>> {
  //account<sub>p</sub> : Account//

}
note left of Subdomain
  a subject in the
  Gateway domain;
  also a domain shared
  to authorised clients
end note
note right of Subdomain::account
  entailed from
  Account.subdomain
end note


class UserKey <<subject>> {
  @id = """.${keyid}" ""
  name? : string
  publicKey : base64Binary
  privateKey : base64Binary
  revoked? : boolean
}
note right of UserKey::name
  account<sub>u</sub>@≪gateway≫
  Not present in config
end note
note right of UserKey::privateKey
  Encrypted with AuthKey
end note
note right of UserKey::revoked
  possibly redundant
  with external keystore
  Assumed ""true"" in config
end note

UserAccount "1" *- - "*" UserKey

class AuthKey <<secret>> {
  keyid : string
  appid : string
  secret : string
}
note right of AuthKey
  String-serialised "API key"
  Usable with Basic HTTP auth
end note

@enduml

@startuml

hide circle
allowmixing

class Gateway <<domain>> <<service>> {
  rootAccount : UserAccount
  rootKey : AuthKey
}

Gateway *- - "*" Account

class Account <<abstract>> <<subject>> {
  subdomain : Subdomain [*]
  naming : any | uuid [*] = any
  remotesAuth : anon | key | jwt [*] = key
}
note right of Account::subdomain
  A Subdomain can only
  appear in one Account
end note
note right of Account::naming
 //any// naming requires an app
 to PUT (sub)domain names.
 //uuid// naming allows any UUID
 (sub)domain name, or
 generate with POST.
 Other options may be added.
end note
note right of Account::remotesAuth
  Allowed remote
  authentication methods
  for subdomain clones.
  Named subdomains may
  override (in future).
end note

Account *- - "*" Subdomain

actor User

class UserAccount <<subject>> {
  email : string [1..*]
  key : UserKey [*]
}
note left of UserAccount::email
  Registered email, used
  for account activation
end note
UserAccount - -|> Account
User ..> UserAccount: has
User ..> "*" AuthKey: has

class OrganisationAccount <<subject>> {
  vf:primaryAccountable : UserAccount [1..*]
}
note right of OrganisationAccount::vf:primaryAccountable
  The account "admins"
end note
OrganisationAccount - -|> Account
OrganisationAccount o- - "1..*" UserAccount

class Subdomain <<domain>> <<subject>> {
  //account<sub>p</sub> : Account//

}
note left of Subdomain
  a subject in the
  Gateway domain;
  also a domain shared
  to authorised clients
end note
note right of Subdomain::account
  entailed from
  Account.subdomain
end note


class UserKey <<subject>> {
  @id = """.${keyid}" ""
  name? : string
  publicKey : base64Binary
  privateKey : base64Binary
  revoked? : boolean
}
note right of UserKey::name
  account<sub>u</sub>@≪gateway≫
  Not present in config
end note
note right of UserKey::privateKey
  Encrypted with AuthKey
end note
note right of UserKey::revoked
  possibly redundant
  with external keystore
  Assumed ""true"" in config
end note

UserAccount "1" *- - "*" UserKey

class AuthKey <<secret>> {
  keyid : string
  appid : string
  secret : string
}
note right of AuthKey
  String-serialised "API key"
  Usable with Basic HTTP auth
end note

@enduml

PlantUML version 1.2022.8(Sun Sep 25 10:00:33 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>